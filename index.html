<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Mini App - Rewards & Investment</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea,#764ba2);
    color: #f0f0f0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  #app {
    flex-grow:1;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 420px;
    margin: 0 auto;
    background: #1f1f3a;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
    overflow: hidden;
  }
  header {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 420px;
    padding: 20px;
    background: #2c2c55;
    text-align: center;
    font-weight: 600;
    font-size: 1.5rem;
    letter-spacing: 1.2px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.8);
    z-index: 1001;
  }
  main {
    flex-grow: 1;
    padding: 80px 20px 20px 20px;
    overflow-y: auto;
  }
  footer {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 420px;
    display: flex;
    background: #222242;
    box-shadow: 0 -6px 20px rgba(0,0,0,0.6);
    border-radius: 16px;
    z-index: 1000;
  }
  footer button {
    flex-grow: 1;
    padding: 12px 0;
    background: none;
    border: none;
    color: #bbb;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.3s, color 0.3s;
    position: relative;
  }
  @media (max-width: 400px) {
    header {
      font-size: 1.2rem;
      padding: 16px 12px;
    }
    main {
      padding: 70px 12px 12px 12px;
    }
    footer button {
      font-size: 0.8rem;
      padding: 10px 0;
    }
  }
  footer button:hover,
  footer button.active {
    color: #fff;
    background: #5e52f3;
  }
  footer button svg {
    width: 24px; height: 24px;
    margin-bottom: 4px;
    fill: currentColor;
  }
  .hidden {
    display: none !important;
  }
  button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.3rem;
    margin-bottom: 16px;
    border-bottom: 2px solid #5e52f3;
    padding-bottom: 6px;
  }
  .card {
    background: #2c2c55;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: inset 0 0 20px rgb(94,82,243, 0.6);
  }
  .referral-link {
    background: #3d3d7a;
    border-radius: 8px;
    padding: 10px;
    font-family: monospace;
    user-select: all;
  }
  .copy-button {
    margin-top: 8px;
    padding: 8px 14px;
    background: #5e52f3;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .copy-button:hover {
    background-color: #483acb;
  }
  input[type=number], input[type=text], select {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    margin-top: 8px;
    background: rgba(255 255 255 / 0.1);
    color: #eee;
    transition: background-color 0.3s;
  }
  /* Change background color for deposit/withdraw method select */
  #deposit-method,
  #withdraw-method {
    background-color: #4a3b8f !important;
  }
  input[type=number]:focus, input[type=text]:focus, select:focus {
    background: rgba(255 255 255 / 0.20);
  }
  label {
    margin-top: 12px;
    font-weight: 600;
  }
  .btn-primary {
    background: #8a64f5;
    color:#fff;
    border: none;
    border-radius: 10px;
    padding: 12px 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 16px;
    width: 100%;
    transition: background-color 0.3s;
  }
  .btn-primary:disabled {
    background: #54438e;
    cursor: not-allowed;
  }
  .btn-primary:hover:not(:disabled) {
    background: #6f45e7;
  }
  .video-wrapper {
    aspect-ratio: 16 / 9;
    margin-bottom: 16px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px rgb(94,82,243, 0.6);
    max-width: 100%;
  }
  .admin-section {
    background: #421f59;
    padding: 14px;
    border-radius: 12px;
  }
  .admin-controls label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
  }
  .admin-controls input[type=checkbox] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
  .toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: #4444cc;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    box-shadow: 0 4px 20px rgb(100 80 255 / 0.9);
    font-weight: 600;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  .user-info {
    text-align: center;
    margin-bottom: 20px;
  }
  .user-info img {
    border-radius: 50%;
    width: 88px;
    height: 88px;
    border: 3px solid #5e52f3;
    margin-bottom: 12px;
  }
  .user-info .username {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 4px;
  }
  /* Total balance frame style */
  .total-balance-card {
    background: linear-gradient(135deg, #7b53ff, #5e52f3);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 18px;
    box-shadow: 0 0 20px #957fff77;
    text-align: center;
  }
  .total-balance-card .balance-label {
    font-size: 1rem;
    font-weight: 600;
    opacity: 0.85;
    margin-bottom: 6px;
  }
  .total-balance-card .balance-amount {
    font-size: 2.2rem;
    font-weight: 800;
  }
  /* Daily bonus UI */
  .daily-bonus {
    background: #3a2a6a;
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 24px;
    text-align: center;
    box-shadow: 0 0 12px #6b52e6aa;
  }
  .daily-bonus .bonus-amount {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: #b8a1ff;
  }
  .daily-bonus .bonus-timer {
    font-size: 0.95rem;
    margin-bottom: 12px;
    opacity: 0.9;
  }
  /* Referral card UI */
  .referral-card {
    background: #3a3a7a;
    border-radius: 14px;
    padding: 16px;
    margin-top: 12px;
    box-shadow: 0 0 15px rgb(94,82,243,0.8);
  }

 

  /* Match Investment History section style to Deposit History section */
  #investment-history-table {
    width: 100%;
    color: #eee;
    border-collapse: collapse;
  }
  #investment-history-table th,
  #investment-history-table td {
    padding: 8px;
    border-bottom: 1px solid #5e52f3;
    text-align: left;
  }
  #investment-history-table thead tr th {
    border-bottom: 1px solid #5e52f3;
  }
  #investment-history-table tbody tr td {
    border-bottom: 1px solid #5e52f3;
  }
  /* Container div for investment history table */
  #investment-history-container {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #5e52f3;
    border-radius: 8px;
    padding: 8px;
  }

  /* Smaller font size for Deposit and Withdraw History sections */
  #deposit-withdraw-section h4 {
    font-size: 0.85rem;
  }
  #deposit-withdraw-section table,
  #deposit-withdraw-section th,
  #deposit-withdraw-section td {
    font-size: 0.85rem;
  }

  /* Smaller font size for Investment History heading */
  #investment-section .card > h4 {
    font-size: 1rem;
  }
</style>
</head>
<body>
<div id="app">
<header>
  Telegram Mini App
</header>
<main>
  <div id="login-section" class="">
    <!-- Telegram Login Widget placeholder -->
    <div style="text-align:center; margin-top:50px;">
      <img src="https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png" alt="Telegram" width="80" />
      <h2>Login with Telegram</h2>
      <button id="btn-tl-login" class="btn-primary">Simulate Telegram Login</button>
      <p>Click the button to simulate Telegram login (since API integration requires backend).</p>
    </div>
  </div>
  <section id="home-section" class="hidden">
    <div class="user-info">
      <img id="user-photo" src="" alt="User Photo" />
      <div class="username" id="user-name"></div>
      <div class="user-id" id="user-id" style="opacity:0.7; font-size:0.8rem;"></div>
    </div>

    <!-- Total Balance Card -->
    <div class="total-balance-card">
      <div class="balance-label">Total Balance</div>
      <div class="balance-amount" id="total-balance">0.00 BDT</div>
    </div>

    <!-- Daily Bonus Section -->
    <div class="daily-bonus">
      <div class="bonus-amount">Daily Bonus: +5 BDT</div>
      <div class="bonus-timer" id="daily-bonus-timer">Loading...</div>
      <button id="claim-daily-bonus" class="btn-primary" disabled>Claim Daily Bonus</button>
    </div>

    <p>Welcome to the Telegram Mini App dashboard.</p>
    
    <!-- Referral Card UI -->
    <div class="referral-card">
      <h3 class="section-title">Referral & Bonus System</h3>
      <div>Your referral link:</div>
      <div class="referral-link" id="referral-link"></div>
      <button class="copy-button" id="copy-referral">Copy Referral Link</button>
      <div style="margin-top: 12px;">
        <strong>Referral Count:</strong> <span id="referral-count">0</span><br/>
        <strong>Bonus Earned:</strong> <span id="bonus-earned">0.00</span> BDT
      </div>
    </div>
  </section>
  <section id="video-ads-section" class="hidden">
    <h3 class="section-title">Video Ads Reward (Claim every hour)</h3>
    <div class="card">
      <h4>Video Ad #1</h4>
      <div class="video-wrapper">
        <iframe
          id="video-iframe-1"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          title="Reward Video 1"
        ></iframe>
      </div>
      <button id="claim-video-reward-1" class="btn-primary">Claim Video Ad Reward #1</button>
      <div id="video-reward-timer-1" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>Video Ad #2</h4>
      <div class="video-wrapper">
        <iframe
          id="video-iframe-2"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          title="Reward Video 2"
        ></iframe>
      </div>
      <button id="claim-video-reward-2" class="btn-primary">Claim Video Ad Reward #2</button>
      <div id="video-reward-timer-2" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>Video Ad #3</h4>
      <div class="video-wrapper">
        <iframe
          id="video-iframe-3"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          title="Reward Video 3"
        ></iframe>
      </div>
      <button id="claim-video-reward-3" class="btn-primary">Claim Video Ad Reward #3</button>
      <div id="video-reward-timer-3" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>Video Ad #4</h4>
      <div class="video-wrapper">
        <iframe
          id="video-iframe-4"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          title="Reward Video 4"
        ></iframe>
      </div>
      <button id="claim-video-reward-4" class="btn-primary">Claim Video Ad Reward #4</button>
      <div id="video-reward-timer-4" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>Video Ad #5</h4>
      <div class="video-wrapper">
        <iframe
          id="video-iframe-5"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          title="Reward Video 5"
        ></iframe>
      </div>
      <button id="claim-video-reward-5" class="btn-primary">Claim Video Ad Reward #5</button>
      <div id="video-reward-timer-5" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
  </section>
  <section id="ppc-section" class="hidden">
    <h3 class="section-title">Pay Per Click Rewards (Claim every hour)</h3>
    <div class="card">
      <h4>PPC Reward #1</h4>
      <button id="claim-ppc-reward-1" class="btn-primary">Claim PPC Reward #1</button>
      <div id="ppc-reward-timer-1" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>PPC Reward #2</h4>
      <button id="claim-ppc-reward-2" class="btn-primary">Claim PPC Reward #2</button>
      <div id="ppc-reward-timer-2" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>PPC Reward #3</h4>
      <button id="claim-ppc-reward-3" class="btn-primary">Claim PPC Reward #3</button>
      <div id="ppc-reward-timer-3" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>PPC Reward #4</h4>
      <button id="claim-ppc-reward-4" class="btn-primary">Claim PPC Reward #4</button>
      <div id="ppc-reward-timer-4" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <h4>PPC Reward #5</h4>
      <button id="claim-ppc-reward-5" class="btn-primary">Claim PPC Reward #5</button>
      <div id="ppc-reward-timer-5" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
  </section>
  <section id="investment-section" class="hidden">
    <h3 class="section-title">Weekly Investment System</h3>
    <!-- Deposit Balance Card -->
    <div class="total-balance-card" style="margin-bottom: 20px;">
      <div class="balance-label">Deposit Balance</div>
      <div class="balance-amount" id="deposit-balance">0.00 BDT</div>
    </div>
    <div class="card" style="margin-bottom: 20px;">
      <label for="transfer-deposit-amount"></label>
      <input type="number" id="transfer-deposit-amount" min="0" step="0.01" placeholder="Enter amount" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: none; outline: none; background: rgba(255 255 255 / 0.1); color: #eee; transition: background-color 0.3s;" />
      <button id="transfer-deposit-btn" class="btn-primary" style="margin-top: 12px;">Transfer Deposit to Main Balance</button>

      <label for="transfer-main-amount" style="margin-top: 20px; display: block;"></label>
      <input type="number" id="transfer-main-amount" min="0" step="0.01" placeholder="Enter amount" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: none; outline: none; background: rgba(255 255 255 / 0.1); color: #eee; transition: background-color 0.3s;" />
      <button id="transfer-main-btn" class="btn-primary" style="margin-top: 12px;">Transfer Main to Deposit</button>
    </div>
    <div class="card">
      <label for="investment-amount">Select Investment Amount (BDT):</label>
      <select id="investment-amount">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="250">250</option>
      </select>
      <button id="invest-btn" class="btn-primary">Invest Now</button>
      <!-- Removed old current investment display as per user request -->
      <!-- <div style="margin-top: 12px;">
        <strong>Your Current Investment:</strong> <span id="current-investment">0</span> BDT
      </div> -->
      <div style="margin-top: 16px; padding: 12px; background: rgba(94,82,243,0.1); border-radius: 8px; font-size: 0.9rem;">
        <strong>Investment Note:</strong><br>
        • Weekly Return: 22% of invested amount<br>
        • Investment Period: 7 weeks<br>
        • Example: Invest 100 BDT → Get 22 BDT weekly for 7 weeks (Total return: 154 BDT)
      </div>
    </div>
    <!-- Investment Balance and Profit Table -->
    <div class="card" style="margin-top: 20px;">
      <h4>Investment Summary</h4>
      <table style="width: 100%; color: #eee; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Investment Balance</th>
            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Profit Balance</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="investment-balance" style="padding: 8px; border-bottom: 1px solid #5e52f3;">0.00 BDT</td>
            <td id="profit-balance" style="padding: 8px; border-bottom: 1px solid #5e52f3;">0.00 BDT</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Investment History Section -->
    <div class="card" style="margin-top: 20px;">
      <h4>Investment History</h4>
      <div id="investment-history-container">
        <table id="investment-history-table" style="width: 100%; color: #eee; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Date</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Amount (BDT)</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Weekly Return</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Weeks Remaining</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Status</th>
            </tr>
          </thead>
          <tbody id="investment-history-body">
            <!-- Investment history rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
  </section>
    <section id="deposit-withdraw-section" class="hidden" style="padding: 20px;">
    <h3 class="section-title">Offline Deposit & Withdraw</h3>
    <div class="card" style="margin-bottom: 20px;">
      <h4>Deposit</h4>
      <form id="deposit-form">
        <label for="deposit-method">Deposit Method:</label>
        <select id="deposit-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="deposit-amount">Amount (BDT):</label>
        <input type="number" id="deposit-amount" min="1" required />
        <label for="deposit-reference">Transaction Reference:</label>
        <input type="text" id="deposit-reference" placeholder="Transaction ID or Details" required />
        <button type="submit" class="btn-primary">Submit Deposit Request</button>
      </form>
      <!-- Deposit History Table -->
      <div style="margin-top: 20px;">
        <h4>Deposit History</h4>
        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #5e52f3; border-radius: 8px; padding: 8px;">
          <table style="width: 100%; color: #eee; border-collapse: collapse;">
            <thead>
              <tr>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Date</th>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Amount (BDT)</th>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Method</th>
                <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Status</th>
              </tr>
            </thead>
            <tbody id="deposit-history-body">
              <!-- Deposit history rows will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="card" style="margin-top: 20px;">
      <h4>Withdraw</h4>
      <form id="withdraw-form">
        <label for="withdraw-method">Withdraw Method:</label>
        <select id="withdraw-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="withdraw-amount">Amount (BDT):</label>
        <input type="number" id="withdraw-amount" min="1" required />
        <label for="withdraw-address">Withdrawal Address / Info:</label>
        <input type="text" id="withdraw-address" placeholder="Your PayPal or bKash Info" required />
        <button type="submit" class="btn-primary">Submit Withdraw Request</button>
      </form>
      <!-- Withdraw History Table -->
      <div style="margin-top: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #5e52f3; border-radius: 8px; padding: 8px;">
        <h4>Withdraw History</h4>
        <table style="width: 100%; color: #eee; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Date</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Amount (BDT)</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Method</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #5e52f3;">Status</th>
            </tr>
          </thead>
          <tbody id="withdraw-history-body">
            <!-- Withdraw history rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
  </section>
  <section id="admin-section" class="hidden admin-section">
    <h3 class="section-title">Admin Panel</h3>
    <div class="admin-controls">
      <label>
        <input type="checkbox" id="toggle-deposit-enabled" /> Deposits Enabled
      </label>
      <label>
        <input type="checkbox" id="toggle-withdraw-enabled" /> Withdrawals Enabled
      </label>
    </div>
  </section>
</main>
<footer>
  <button id="nav-home" class="active" aria-label="Home" title="Home">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    Home
  </button>
  <button id="nav-video" aria-label="Video Ads" title="Video Ads">
    <svg viewBox="0 0 24 24"><path d="M10 16.5l6-4.5-6-4.5v9z"/></svg>
    Video Ads
  </button>
  <button id="nav-ppc" aria-label="PPC Rewards" title="PPC Rewards">
    <svg viewBox="0 0 24 24"><path d="M13 17h-2v-2h2v2zm0-6h-2v-2h2v2zm4 4h-2v-2h2v2zm-8 0H7v-2h2v2zm8-4h-2V9h2v2zm-4 8c3.31 0 6-2.69 6-6h-2a4 4 0 01-4 4v2zm-6-6a6 6 0 0111.9-1h-2A4 4 0 009 13v2H7v-2z"/></svg>
    PPC
  </button>
  <button id="nav-investment" aria-label="Investment" title="Investment">
    <!-- Investment icon: upward trend chart -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M4 17h16v2H4v-2zm2-5h3v5H6v-5zm5-4h3v9h-3V8zm5-3h3v12h-3V5z"/></svg>
    Invest
  </button>
  <button id="nav-deposit" aria-label="Wallet" title="Wallet">
    <!-- Wallet icon -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M21 7H3c-.55 0-1 .45-1 1v8a3 3 0 0 0 3 3h13c1.1 0 2-.9 2-2v-8c0-.55-.45-1-1-1zm-7 5a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/></svg>
    Wallet
  </button>
  <button id="nav-admin" aria-label="Admin Panel" title="Admin Panel" class="hidden">
    <svg viewBox="0 0 24 24"><path d="M12 2L2 7v6c0 5 4 9 10 9s10-4 10-9V7l-10-5zm0 4l6 3.5v5L12 17l-6-2.5v-5L12 6z"/></svg>
    Admin
  </button>
</footer>
</div>

<div id="toast" class="toast">Message</div>

<script>
    (() => {
    const userDataKey = 'telegramMiniAppUser';
    const referralBaseURL = 'https://t.me/your_bot?start=';
    const referralBonusPerReferral = 1.5; // BDT coins per referral
    const dailyBonusAmount = 5; // Daily bonus amount BDT
    const videoRewardAmount = 2.5; // BDT per video ad claim
    const ppcRewardAmount = 1.2; // BDT per PPC claim
    // Reward claim cooldowns in ms
    const rewardCooldown = 1000 * 60 * 60; // 1 hour cooldown
    const dailyBonusCooldown = 1000 * 60 * 60 * 24; // 24 hours for daily bonus

    // Admin settings and state
    const ADMIN_SETTINGS_KEY = 'adminSettings';
    
    // State
    let user = null;
    let referrals = []; // Array of user ids who used referral link
    let dailyClaimBonus = 0;
    let referralBonus = 0;
    let videoRewards = 0;
    let ppcRewards = 0;
    let currentInvestment = 0;
    let depositEnabled = true;
    let withdrawEnabled = true;
    let registrationsEnabled = true;
    let rewardsEnabled = true;

    // Define bonus as sum of dailyClaimBonus and referralBonus
    let bonus = 0;

    // Load admin settings
    function loadAdminSettings() {
      const settings = localStorage.getItem(ADMIN_SETTINGS_KEY);
      if (settings) {
        try {
          const adminSettings = JSON.parse(settings);
          depositEnabled = adminSettings.depositsEnabled;
          withdrawEnabled = adminSettings.withdrawalsEnabled;
          registrationsEnabled = adminSettings.registrationsEnabled;
          rewardsEnabled = adminSettings.rewardsEnabled;
        } catch (e) {
          console.error('Error loading admin settings:', e);
        }
      }
    }

    // Elements
    const loginSection = document.getElementById('login-section');
    const homeSection = document.getElementById('home-section');
    const videoAdsSection = document.getElementById('video-ads-section');
    const ppcSection = document.getElementById('ppc-section');
    const investmentSection = document.getElementById('investment-section');
    const depositWithdrawSection = document.getElementById('deposit-withdraw-section');
    const adminSection = document.getElementById('admin-section');

    const navButtons = {
      home: document.getElementById('nav-home'),
      video: document.getElementById('nav-video'),
      ppc: document.getElementById('nav-ppc'),
      investment: document.getElementById('nav-investment'),
      deposit: document.getElementById('nav-deposit'),
      admin: document.getElementById('nav-admin')
    };

    const userPhotoEl = document.getElementById('user-photo');
    const userNameEl = document.getElementById('user-name');
    const userIdEl = document.getElementById('user-id');

    const referralLinkEl = document.getElementById('referral-link');
    const referralCountEl = document.getElementById('referral-count');
    const bonusEarnedEl = document.getElementById('bonus-earned');

    const copyReferralBtn = document.getElementById('copy-referral');

    const claimVideoRewardBtns = [
      document.getElementById('claim-video-reward-1'),
      document.getElementById('claim-video-reward-2'),
      document.getElementById('claim-video-reward-3'),
      document.getElementById('claim-video-reward-4'),
      document.getElementById('claim-video-reward-5')
    ];
    const videoRewardTimers = [
      document.getElementById('video-reward-timer-1'),
      document.getElementById('video-reward-timer-2'),
      document.getElementById('video-reward-timer-3'),
      document.getElementById('video-reward-timer-4'),
      document.getElementById('video-reward-timer-5')
    ];

    const claimPpcRewardBtns = [
      document.getElementById('claim-ppc-reward-1'),
      document.getElementById('claim-ppc-reward-2'),
      document.getElementById('claim-ppc-reward-3'),
      document.getElementById('claim-ppc-reward-4'),
      document.getElementById('claim-ppc-reward-5')
    ];
    const ppcRewardTimers = [
      document.getElementById('ppc-reward-timer-1'),
      document.getElementById('ppc-reward-timer-2'),
      document.getElementById('ppc-reward-timer-3'),
      document.getElementById('ppc-reward-timer-4'),
      document.getElementById('ppc-reward-timer-5')
    ];

    const investmentAmountSel = document.getElementById('investment-amount');
    const investBtn = document.getElementById('invest-btn');
    const currentInvestmentEl = document.getElementById('current-investment');

    const depositForm = document.getElementById('deposit-form');
    const withdrawForm = document.getElementById('withdraw-form');

    const depositMethodSelect = document.getElementById('deposit-method');
    const withdrawMethodSelect = document.getElementById('withdraw-method');

    const depositAmountInput = document.getElementById('deposit-amount');
    const depositReferenceInput = document.getElementById('deposit-reference');

    const withdrawAmountInput = document.getElementById('withdraw-amount');
    const withdrawAddressInput = document.getElementById('withdraw-address');

    const toggleDepositEnabled = document.getElementById('toggle-deposit-enabled');
    const toggleWithdrawEnabled = document.getElementById('toggle-withdraw-enabled');

    const toastEl = document.getElementById('toast');

    // New daily bonus elements
    const dailyBonusTimerEl = document.getElementById('daily-bonus-timer');
    const claimDailyBonusBtn = document.getElementById('claim-daily-bonus');
    const totalBalanceEl = document.getElementById('total-balance');

    // Utility for toast message
    function showToast(msg, duration=3000) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => {
        toastEl.classList.remove('show');
      }, duration);
    }

    // Save user data and state to localStorage
    function saveUserData() {
      if (user) {
        const userData = {
          user,
          referrals,
          dailyClaimBonus,
          referralBonus,
          videoRewards,
          ppcRewards,
          currentInvestment,
          lastVideoClaim: parseInt(localStorage.getItem('lastVideoClaim')) || 0,
          lastPpcClaim: parseInt(localStorage.getItem('lastPpcClaim')) || 0,
          depositEnabled,
          withdrawEnabled,
          lastDailyBonusClaim: parseInt(localStorage.getItem('lastDailyBonusClaim')) || 0,
          lastActive: Date.now()
        };
        
        localStorage.setItem(userDataKey, JSON.stringify(userData));
        
        // Update registered users list for admin panel
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        const existingUserIndex = registeredUsers.findIndex(u => u.id === user.id);
        
        if (existingUserIndex !== -1) {
          // Update existing user
          registeredUsers[existingUserIndex] = {
            ...registeredUsers[existingUserIndex],
            lastActive: Date.now(),
            lastLogin: Date.now()
          };
        } else {
          // Add new user
          registeredUsers.push({
            id: user.id,
            first_name: user.first_name,
            last_name: user.last_name,
            username: user.username,
            registeredAt: Date.now(),
            lastActive: Date.now(),
            lastLogin: Date.now()
          });
        }
        
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
      }
    }

    // Load user data from localStorage
    function loadUserData() {
      const saved = localStorage.getItem(userDataKey);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          user = data.user || null;
          referrals = data.referrals || [];
          dailyClaimBonus = data.dailyClaimBonus || 0;
          referralBonus = data.referralBonus || 0;
          videoRewards = data.videoRewards || 0;
          ppcRewards = data.ppcRewards || 0;
          currentInvestment = data.currentInvestment || 0;
          depositEnabled = data.depositEnabled !== undefined ? data.depositEnabled : true;
          withdrawEnabled = data.withdrawEnabled !== undefined ? data.withdrawEnabled : true;

          // Update bonus after loading user data
          bonus = dailyClaimBonus + referralBonus;

          return true;
        } catch {
          return false;
        }
      }
      return false;
    }

    // Format time left in h:mm:ss
    function formatTimeLeft(ms) {
      if (ms <= 0) return 'Ready to claim';
      const totalSeconds = Math.floor(ms / 1000);
      const h = Math.floor(totalSeconds / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      const s = totalSeconds % 60;
      return `${h ? h + 'h ' : ''}${m}m ${s}s`;
    }

    // Check if user is admin (using admin session)
    function isAdmin() {
      const adminSession = localStorage.getItem('adminSession');
      if (!adminSession) return false;
      
      try {
        const sessionData = JSON.parse(adminSession);
        const now = Date.now();
        const sessionAge = now - sessionData.timestamp;
        const maxAge = 24 * 60 * 60 * 1000; // 24 hours
        return sessionAge < maxAge;
      } catch {
        return false;
      }
    }

    // Render user info and UI parts according to user state
    function renderUI() {
      if (!user) {
        loginSection.classList.remove('hidden');
        homeSection.classList.add('hidden');
        videoAdsSection.classList.add('hidden');
        ppcSection.classList.add('hidden');
        investmentSection.classList.add('hidden');
        depositWithdrawSection.classList.add('hidden');
        adminSection.classList.add('hidden');
        navButtons.admin.classList.add('hidden');
        return;
      }
      loginSection.classList.add('hidden');
      // Show home section and other sections as per nav
      navButtons.admin.classList.toggle('hidden', !isAdmin());

      // Show the first active content (home)
      showSection('home');

      // Update user info display
      userPhotoEl.src = user.photo_url || 'https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png';
      userNameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      userIdEl.textContent = "User ID: " + user.id;

      referralLinkEl.textContent = referralBaseURL + user.id;
      referralCountEl.textContent = referrals.length;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);

      // Total Balance = bonus + currentInvestment for demonstration
      const totalBalance = bonus + currentInvestment;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';

      // Set deposit/withdraw enable switches in admin panel
      toggleDepositEnabled.checked = depositEnabled;
      toggleWithdrawEnabled.checked = withdrawEnabled;

      // Enable or disable deposit/withdraw forms based on admin control
      depositMethodSelect.disabled = !depositEnabled;
      depositAmountInput.disabled = !depositEnabled;
      depositReferenceInput.disabled = !depositEnabled;
      depositForm.querySelector('button[type="submit"]').disabled = !depositEnabled;

      withdrawMethodSelect.disabled = !withdrawEnabled;
      withdrawAmountInput.disabled = !withdrawEnabled;
      withdrawAddressInput.disabled = !withdrawEnabled;
      withdrawForm.querySelector('button[type="submit"]').disabled = !withdrawEnabled;

      // Update reward buttons cooldown timers
      updateRewardButtons();

      // Update daily bonus state UI
      updateDailyBonusUI();
    }

    // Show only one main section at a time
    function showSection(sectionName) {
      const sections = {
        home: homeSection,
        video: videoAdsSection,
        ppc: ppcSection,
        investment: investmentSection,
        deposit: depositWithdrawSection,
        admin: adminSection
      };
      Object.entries(sections).forEach(([key, el]) => {
        el.classList.toggle('hidden', key !== sectionName);
      });
      // Set active nav button
      Object.entries(navButtons).forEach(([key, btn]) => {
        btn.classList.toggle('active', key === sectionName);
      });
    }

    // Navigation buttons listeners
    Object.entries(navButtons).forEach(([key, btn]) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first.');
          return;
        }
        showSection(key);
        // Ensure active class toggling is correct
        Object.entries(navButtons).forEach(([k, b]) => {
          b.classList.toggle('active', k === key);
        });
      });
    });

    // Copy referral link
    copyReferralBtn.addEventListener('click', () => {
      if (!navigator.clipboard) {
        showToast('Clipboard not supported');
        return;
      }
      navigator.clipboard.writeText(referralLinkEl.textContent)
        .then(() => showToast('Referral link copied!'))
        .catch(() => showToast('Failed to copy'));
    });

    // Handle Telegram login simulation
    document.getElementById('btn-tl-login').addEventListener('click', () => {
      if (!registrationsEnabled) {
        showToast('New registrations are currently disabled by admin.');
        return;
      }
      // Simulate login and store user data
      // Normally you get this data from Telegram widget with backend token check
      const simulatedUser = {
        id: Math.floor(Math.random() * 1000000) + 10000,
        first_name: 'Demo',
        last_name: 'User',
        username: 'demouser',
        photo_url: 'https://randomuser.me/api/portraits/lego/5.jpg'
      };
      setUser(simulatedUser);
    });

    // Set user after login
    function setUser(newUser) {
      user = newUser;
      // Check if this user came from referral param in URL (simulate it)
      const urlParams = new URLSearchParams(window.location.search);
      const referralId = urlParams.get('start'); // Telegram passes referral as ?start=...
      if (referralId && referralId != user.id.toString()) {
        // Add referral if not already
        if (!referrals.includes(referralId)) {
          referrals.push(referralId);
          referralBonus += referralBonusPerReferral;
          showToast(`Referral bonus added: +${referralBonusPerReferral} BDT`);
        }
      }
      saveUserData();
      renderUI();
      showToast('Logged in as ' + user.first_name);
    }

    // Reward claim timers
    function canClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      return now - lastClaim >= cooldown;
    }
    function timeToNextClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      const diff = cooldown - (now - lastClaim);
      return diff > 0 ? diff : 0;
    }

    // Claim video ad reward handlers for all 5 buttons
    claimVideoRewardBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first');
          return;
        }
        if (!rewardsEnabled) {
          showToast('Rewards are currently disabled by admin.');
          return;
        }
        const videoClaimKey = `lastVideoClaim${index + 1}`;
        if (!canClaim(videoClaimKey, rewardCooldown)) {
          showToast(`Video reward #${index + 1} already claimed. Please wait.`);
          return;
        }
        // Simulate watching ad completion
        btn.disabled = true;
        showToast(`Watching Video Ad #${index + 1}...`);
        setTimeout(() => {
          videoRewards += videoRewardAmount;
          localStorage.setItem(videoClaimKey, Date.now().toString());
          saveUserData();
          updateRewardButtons();
          showToast(`You earned +${videoRewardAmount} BDT from video ad #${index + 1}!`);
          btn.disabled = false;
          bonus = dailyClaimBonus + referralBonus;
          bonusEarnedEl.textContent = bonus.toFixed(2);
          updateTotalBalance();
        }, 4000);
      });
    });

    // Claim PPC reward handlers for all 5 buttons
    claimPpcRewardBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first');
          return;
        }
        if (!rewardsEnabled) {
          showToast('Rewards are currently disabled by admin.');
          return;
        }
        const ppcClaimKey = `lastPpcClaim${index + 1}`;
        if (!canClaim(ppcClaimKey, rewardCooldown)) {
          showToast(`PPC reward #${index + 1} already claimed. Please wait.`);
          return;
        }
        btn.disabled = true;
        showToast(`Processing PPC claim #${index + 1}...`);
        setTimeout(() => {
          ppcRewards += ppcRewardAmount;
          localStorage.setItem(ppcClaimKey, Date.now().toString());
          saveUserData();
          updateRewardButtons();
          showToast(`You earned +${ppcRewardAmount} BDT from PPC #${index + 1}!`);
          btn.disabled = false;
          bonus = dailyClaimBonus + referralBonus;
          bonusEarnedEl.textContent = bonus.toFixed(2);
          updateTotalBalance();
        }, 3000);
      });
    });

    // Update cooldown timers for reward buttons
    function updateRewardButtons() {
      // Video ad rewards - handle all 5 buttons
      claimVideoRewardBtns.forEach((btn, index) => {
        const videoClaimKey = `lastVideoClaim${index + 1}`;
        if (canClaim(videoClaimKey, rewardCooldown)) {
          videoRewardTimers[index].textContent = 'Ready to claim';
          btn.disabled = false;
        } else {
          const timeLeft = timeToNextClaim(videoClaimKey, rewardCooldown);
          videoRewardTimers[index].textContent = 'Next claim in: ' + formatTimeLeft(timeLeft);
          btn.disabled = true;
        }
      });
      // PPC rewards - handle all 5 buttons
      claimPpcRewardBtns.forEach((btn, index) => {
        const ppcClaimKey = `lastPpcClaim${index + 1}`;
        if (canClaim(ppcClaimKey, rewardCooldown)) {
          ppcRewardTimers[index].textContent = 'Ready to claim';
          btn.disabled = false;
        } else {
          const timeLeft = timeToNextClaim(ppcClaimKey, rewardCooldown);
          ppcRewardTimers[index].textContent = 'Next claim in: ' + formatTimeLeft(timeLeft);
          btn.disabled = true;
        }
      });
    }

    // Update total balance display
    function updateTotalBalance() {
      const totalBalance = dailyClaimBonus + referralBonus + videoRewards + ppcRewards;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';
    }

    // Daily bonus UI update
    function updateDailyBonusUI() {
      if (!user) {
        dailyBonusTimerEl.textContent = '';
        claimDailyBonusBtn.disabled = true;
        return;
      }
      if (canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
        dailyBonusTimerEl.textContent = 'Ready to claim your daily bonus!';
        claimDailyBonusBtn.disabled = false;
      } else {
        const timeLeft = timeToNextClaim('lastDailyBonusClaim', dailyBonusCooldown);
        dailyBonusTimerEl.textContent = 'Next daily bonus in: ' + formatTimeLeft(timeLeft);
        claimDailyBonusBtn.disabled = true;
      }
    }

    // Daily bonus claim handler
    claimDailyBonusBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (!rewardsEnabled) {
        showToast('Rewards are currently disabled by admin.');
        return;
      }
      if (!canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
        showToast('Daily bonus already claimed. Please wait.');
        return;
      }
      dailyClaimBonus += dailyBonusAmount;
      localStorage.setItem('lastDailyBonusClaim', Date.now().toString());
      saveUserData();
      updateDailyBonusUI();
      bonus = dailyClaimBonus + referralBonus;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`You claimed your daily bonus of +${dailyBonusAmount} BDT!`);
    });

    // Update timers every second
    setInterval(() => {
      if (user) {
        updateRewardButtons();
        updateDailyBonusUI();
      }
    }, 1000);

    // Investment button
    investBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      const amount = parseFloat(investmentAmountSel.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Select a valid amount');
        return;
      }
      if (amount > depositBalance) {
        showToast('Insufficient deposit balance for this investment.');
        return;
      }
      
      // Create investment record for admin tracking
      const investment = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        startDate: new Date(),
        weeklyReturn: amount * 0.22, // 22% weekly return
        totalReturns: 0,
        status: 'active',
        weeksRemaining: 7 // 7 weeks investment period
      };
      
      // Save investment to localStorage for admin panel
      const existingInvestments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      existingInvestments.push(investment);
      localStorage.setItem('userInvestments', JSON.stringify(existingInvestments));
      
      depositBalance -= amount;
      saveUserData();
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      updateTotalBalance();
      showToast(`Invested ${amount.toFixed(2)} BDT successfully! Weekly return: ${investment.weeklyReturn.toFixed(2)} BDT`);
      
      // Render updated investment history
      renderInvestmentHistory();
    });

    // Function to render investment history table
    function renderInvestmentHistory() {
      if (!user) return;
      const investments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      const userInvestments = investments.filter(inv => inv.userId === user.id);
      const tbody = document.getElementById('investment-history-body');
      tbody.innerHTML = '';
      userInvestments.sort((a, b) => b.startDate - a.startDate);
      userInvestments.forEach(inv => {
        const tr = document.createElement('tr');
        const date = new Date(inv.startDate);
        tr.innerHTML = `
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${date.toLocaleString()}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${inv.amount.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${inv.weeklyReturn.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${inv.weeksRemaining}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${inv.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Call renderInvestmentHistory on UI render
    const originalRenderUI = renderUI;
    renderUI = function() {
      originalRenderUI();
      renderInvestmentHistory();
    };

    // Variables for deposit balance and profit
    let depositBalance = 0;
    const depositBalanceEl = document.getElementById('deposit-balance');
    const investmentBalanceEl = document.getElementById('investment-balance');
    const profitBalanceEl = document.getElementById('profit-balance');
    const transferDepositBtn = document.getElementById('transfer-deposit-btn');

    // Function to calculate investment profit after 7 days
    function calculateInvestmentProfit() {
      const investments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      let totalInvestment = 0;
      let totalProfit = 0;
      const now = new Date();

      investments.forEach(inv => {
        if (inv.status === 'active') {
          totalInvestment += inv.amount;
          const startDate = new Date(inv.startDate);
          const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
          if (daysPassed >= 7) {
            // Profit for 1 week (22% of amount)
            totalProfit += inv.weeklyReturn;
          }
        }
      });

      return { totalInvestment, totalProfit };
    }

    // Function to update balances and UI
    function updateBalances() {
      // Load deposit balance from localStorage or initialize
      depositBalance = parseFloat(localStorage.getItem('depositBalance')) || 0;

      // Calculate investment profit and balance
      const { totalInvestment, totalProfit } = calculateInvestmentProfit();

      // Add profit to deposit balance
      depositBalance += totalProfit;

      // Update UI elements
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      investmentBalanceEl.textContent = totalInvestment.toFixed(2);
      profitBalanceEl.textContent = totalProfit.toFixed(2);

      // Save updated deposit balance
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
    }

    // Auto-refresh balances every 10 seconds
    setInterval(() => {
      if (user) {
        updateBalances();
        // Enable or disable transfer button based on deposit balance
        transferDepositBtn.disabled = depositBalance <= 0;
      }
    }, 10000);

    // Initial balance update on page load
    updateBalances();

    // Transfer deposit to main balance button click handler
    transferDepositBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (depositBalance <= 0) {
        showToast('No deposit balance to transfer.');
        return;
      }
      const transferAmountInput = document.getElementById('transfer-deposit-amount');
      const amount = parseFloat(transferAmountInput.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid amount to transfer.');
        return;
      }
      if (amount > depositBalance) {
        showToast('Insufficient deposit balance to transfer that amount.');
        return;
      }
      // Transfer specified amount from deposit balance to bonus
      // Update all bonus components accordingly
      dailyClaimBonus += amount; // Add to dailyClaimBonus as main balance component
      depositBalance -= amount;
      // Save updated balances
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
      saveUserData();
      // Update bonus variable to include all components
      bonus = dailyClaimBonus + referralBonus + videoRewards + ppcRewards;
      // Save updated user data with new bonus components
      const userDataStr = localStorage.getItem(userDataKey);
      if (userDataStr) {
        try {
          const userData = JSON.parse(userDataStr);
          userData.dailyClaimBonus = dailyClaimBonus;
          localStorage.setItem(userDataKey, JSON.stringify(userData));
        } catch (e) {
          console.error('Error saving dailyClaimBonus:', e);
        }
      }
      // Update UI
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Successfully transferred ${amount.toFixed(2)} BDT from deposit to main balance.`);
      // Disable button if deposit balance is zero
      transferDepositBtn.disabled = depositBalance <= 0;
      // Clear input
      transferAmountInput.value = '';
    });

    // New transfer main balance to deposit balance button click handler
    const transferMainBtn = document.getElementById('transfer-main-btn');
    const transferMainAmountInput = document.getElementById('transfer-main-amount');

    transferMainBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      const amount = parseFloat(transferMainAmountInput.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid amount to transfer.');
        return;
      }
      if (amount > bonus) {
        showToast('Insufficient main balance to transfer that amount.');
        return;
      }
      // Perform transfer
      dailyClaimBonus -= amount; // Deduct from dailyClaimBonus as main balance component
      depositBalance += amount;
      // Save updated balances
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
      saveUserData();
      // Update bonus variable to include all components
      bonus = dailyClaimBonus + referralBonus + videoRewards + ppcRewards;
      // Save updated user data with new bonus components
      const userDataStr = localStorage.getItem(userDataKey);
      if (userDataStr) {
        try {
          const userData = JSON.parse(userDataStr);
          userData.dailyClaimBonus = dailyClaimBonus;
          localStorage.setItem(userDataKey, JSON.stringify(userData));
        } catch (e) {
          console.error('Error saving dailyClaimBonus:', e);
        }
      }
      // Update UI
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Successfully transferred ${amount.toFixed(2)} BDT from main balance to deposit balance.`);
      // Clear input
      transferMainAmountInput.value = '';
    });

    // Deposit form handling
    depositForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!depositEnabled) {
        showToast('Deposits are currently disabled.');
        return;
      }
      if (!user) {
        showToast('Please login first');
        return;
      }
      const method = depositMethodSelect.value;
      const amount = parseFloat(depositAmountInput.value);
      const reference = depositReferenceInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !reference) {
        showToast('Please fill all deposit fields correctly.');
        return;
      }
      
      // Save deposit request for admin panel
      const deposits = JSON.parse(localStorage.getItem('deposits') || '[]');
      const newDeposit = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        method: method,
        reference: reference,
        status: 'pending',
        timestamp: Date.now()
      };
      
      deposits.push(newDeposit);
      localStorage.setItem('deposits', JSON.stringify(deposits));
      
      showToast(`Deposit request sent (${method.toUpperCase()}, ${amount}). Admin will verify soon.`);
      depositForm.reset();
      renderDepositHistory(); // Update deposit history after new request
    });
    // Withdraw form handling
    withdrawForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!withdrawEnabled) {
        showToast('Withdrawals are currently disabled.');
        return;
      }
      if (!user) {
        showToast('Please login first');
        return;
      }
      const method = withdrawMethodSelect.value;
      const amount = parseFloat(withdrawAmountInput.value);
      const address = withdrawAddressInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !address) {
        showToast('Please fill all withdraw fields correctly.');
        return;
      }
      // Check if user has enough bonus balance to withdraw
      if (amount > bonus) {
        showToast('Insufficient balance to withdraw that amount.');
        return;
      }

      // Save withdrawal request for admin panel
      const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
      const newWithdrawal = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        method: method,
        address: address,
        status: 'pending',
        timestamp: Date.now()
      };
      
      withdrawals.push(newWithdrawal);
      localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
      
      // Deduct amount from dailyClaimBonus first, then referralBonus if needed
      let remainingAmount = amount;
      if (dailyClaimBonus >= remainingAmount) {
        dailyClaimBonus -= remainingAmount;
        remainingAmount = 0;
      } else {
        remainingAmount -= dailyClaimBonus;
        dailyClaimBonus = 0;
      }
      if (remainingAmount > 0) {
        referralBonus = Math.max(0, referralBonus - remainingAmount);
      }

      saveUserData();
      bonus = dailyClaimBonus + referralBonus + videoRewards + ppcRewards;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Withdraw request sent (${method.toUpperCase()}, ${amount}). Admin will process soon.`);
      withdrawForm.reset();
      renderWithdrawHistory(); // Update withdraw history after new request
    });

    // Admin section navigation
    navButtons.admin.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      // Redirect to admin panel if admin
      if (isAdmin()) {
        window.location.href = 'admin.html';
      } else {
        showToast('Access denied: Admin privileges required');
      }
    });

    // Load admin settings on initialization
    loadAdminSettings();

    // Initialization
    if (!loadUserData()) {
      console.log('No saved user data found.');
    }
    renderUI();

    // Render deposit history for current user
    function renderDepositHistory() {
      const deposits = JSON.parse(localStorage.getItem('deposits') || '[]');
      const userDeposits = deposits.filter(d => user && d.userId === user.id);
      const tbody = document.getElementById('deposit-history-body');
      tbody.innerHTML = '';
      userDeposits.sort((a, b) => b.timestamp - a.timestamp);
      userDeposits.forEach(d => {
        const tr = document.createElement('tr');
        const date = new Date(d.timestamp);
        tr.innerHTML = `
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${date.toLocaleString()}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${d.amount.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${d.method}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${d.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Render withdraw history for current user
    function renderWithdrawHistory() {
      const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
      const userWithdrawals = withdrawals.filter(w => user && w.userId === user.id);
      const tbody = document.getElementById('withdraw-history-body');
      tbody.innerHTML = '';
      userWithdrawals.sort((a, b) => b.timestamp - a.timestamp);
      userWithdrawals.forEach(w => {
        const tr = document.createElement('tr');
        const date = new Date(w.timestamp);
        tr.innerHTML = `
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${date.toLocaleString()}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${w.amount.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${w.method}</td>
          <td style="padding: 8px; border-bottom: 1px solid #5e52f3;">${w.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Call render history functions on UI render
    function renderUI() {
      if (!user) {
        loginSection.classList.remove('hidden');
        homeSection.classList.add('hidden');
        videoAdsSection.classList.add('hidden');
        ppcSection.classList.add('hidden');
        investmentSection.classList.add('hidden');
        depositWithdrawSection.classList.add('hidden');
        adminSection.classList.add('hidden');
        navButtons.admin.classList.add('hidden');
        return;
      }
      loginSection.classList.add('hidden');
      // Show home section and other sections as per nav
      navButtons.admin.classList.toggle('hidden', !isAdmin());

      // Show the first active content (home)
      showSection('home');

      // Update user info display
      userPhotoEl.src = user.photo_url || 'https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png';
      userNameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      userIdEl.textContent = "User ID: " + user.id;

      referralLinkEl.textContent = referralBaseURL + user.id;
      referralCountEl.textContent = referrals.length;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);

      // Total Balance = bonus + currentInvestment for demonstration
      const totalBalance = bonus + currentInvestment;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';

      // Set deposit/withdraw enable switches in admin panel
      toggleDepositEnabled.checked = depositEnabled;
      toggleWithdrawEnabled.checked = withdrawEnabled;

      // Enable or disable deposit/withdraw forms based on admin control
      depositMethodSelect.disabled = !depositEnabled;
      depositAmountInput.disabled = !depositEnabled;
      depositReferenceInput.disabled = !depositEnabled;
      depositForm.querySelector('button[type="submit"]').disabled = !depositEnabled;

      withdrawMethodSelect.disabled = !withdrawEnabled;
      withdrawAmountInput.disabled = !withdrawEnabled;
      withdrawAddressInput.disabled = !withdrawEnabled;
      withdrawForm.querySelector('button[type="submit"]').disabled = !withdrawEnabled;

      // Update reward buttons cooldown timers
      updateRewardButtons();

      // Update daily bonus state UI
      updateDailyBonusUI();

      // Render deposit and withdraw history
      renderDepositHistory();
      renderWithdrawHistory();
    }

  })();
</script>
</body>
</html>

