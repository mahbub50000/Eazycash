<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Mini App - Rewards & Investments</title>
<style>
  /* Reset & base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0;
    color: #222;
  }
  header {
    background: linear-gradient(135deg, #0088cc, #0057a8);
    color: white;
    padding: 1rem 2rem;
    text-align: center;
    font-weight: 700;
    font-size: 1.4rem;
    letter-spacing: 0.05em;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  main {
    max-width: 960px;
    margin: 2rem auto 4rem;
    padding: 0 1rem;
  }
  section {
    background: white;
    margin-bottom: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgb(0 0 0 / 0.1);
    padding: 1.5rem 2rem;
  }
  h2 {
    margin-top: 0;
    color: #0057a8;
    font-weight: 700;
    font-size: 1.3rem;
  }
  .button {
    cursor: pointer;
    background: #0088cc;
    color: #fff;
    border: none;
    padding: 0.6rem 1.5rem;
    font-weight: 700;
    border-radius: 8px;
    font-size: 1rem;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .button:hover:not(:disabled) {
    background: #0057a8;
  }
  .button:disabled {
    background: #bbb;
    cursor: not-allowed;
  }
  #telegram-login {
    margin: 1rem auto;
    display: flex;
    justify-content: center;
  }
  .info {
    background: #e0f3ff;
    border-left: 5px solid #0088cc;
    padding: 0.8rem 1rem;
    border-radius: 6px;
    margin-bottom: 1.2rem;
  }
  .referral-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 0.8rem;
  }
  input.referral-input {
    border: 1.5px solid #0088cc;
    padding: 0.5rem;
    border-radius: 8px;
    font-size: 1rem;
    width: 100%;
    user-select: all;
  }
  .reward-list, .investment-list, .admin-list {
    list-style: none;
    padding-left: 0;
  }
  .reward-list li, .investment-list li, .admin-list li {
    padding: 0.4rem 0;
    border-bottom: 1px solid #eee;
  }
  label {
    font-weight: 600;
  }
  form > div {
    margin-bottom: 1.1rem;
  }
  input[type="text"], input[type="number"], select {
    padding: 0.5rem;
    width: 100%;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    font-size: 1rem;
  }
  textarea {
    width: 100%;
    height: 80px;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    padding: 0.7rem;
    font-size: 1rem;
    resize: none;
  }
  .flex-row {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }
  footer {
    text-align: center;
    padding: 1rem;
    font-size: 0.85rem;
    color: #777;
  }

  /* Scrollable embed video container */
  .video-container {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    border-radius: 12px;
    margin-bottom: 1rem;
    box-shadow: 0 6px 18px rgb(0 86 168 / 0.3);
  }
  .video-container iframe, .video-container video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  /* Admin panel tabs */
  .tab-buttons {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .tab-button {
    flex: 1;
    background: #0088cc;
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    padding: 0.7rem 0;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .tab-button.active, .tab-button:hover {
    background: #0057a8;
  }
  .hidden {
    display: none;
  }
  .success-msg {
    padding: 0.8rem 1rem;
    background-color: #d1e7dd;
    color: #0f5132;
    border-radius: 8px;
    margin-top: 1rem;
  }
  .error-msg {
    padding: 0.8rem 1rem;
    background-color: #f8d7da;
    color: #842029;
    border-radius: 8px;
    margin-top: 1rem;
  }
</style>
</head>
<body>
<header>
  Telegram Mini App - Reward & Investment System
</header>
<main>
  <section id="login-section">
    <h2>Login with Telegram</h2>
    <div id="telegram-login"></div>
    <div id="user-info" class="info" style="display:none;">
      <p>Hello, <span id="user-name"></span>! Your Telegram ID: <span id="user-id"></span></p>
      <p>Your Referral Link:</p>
      <div class="referral-link">
        <input type="text" readonly class="referral-input" id="referral-link" />
        <button class="button" id="copy-referral-btn" title="Copy referral link">Copy</button>
      </div>
      <p id="bonus-info"></p>
      <button class="button" id="logout-btn">Logout</button>
    </div>
  </section>

  <section id="video-ads-section" style="display:none;">
    <h2>Watch Video Ads and Earn Rewards</h2>
    <div class="video-container">
      <iframe id="video-iframe" src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&rel=0&origin=https://t.me" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
    <button class="button" id="watch-ad-btn" disabled>Watch Complete to Earn</button>
    <p id="ad-reward-msg"></p>
  </section>

  <section id="pay-per-click-section" style="display:none;">
    <h2>Pay Per Click Rewards</h2>
    <p>Click the ads below to earn rewards:</p>
    <div class="flex-row">
      <a href="https://example.com/ad1" target="_blank" class="button ppc-ad-btn">Ad 1</a>
      <a href="https://example.com/ad2" target="_blank" class="button ppc-ad-btn">Ad 2</a>
      <a href="https://example.com/ad3" target="_blank" class="button ppc-ad-btn">Ad 3</a>
    </div>
    <p id="ppc-reward-msg"></p>
  </section>

  <section id="investment-section" style="display:none;">
    <h2>Weekly Investment System</h2>
    <p>Your current investment: <strong><span id="investment-amount">0</span> USD</strong></p>
    <form id="investment-form">
      <div>
        <label for="investment-input">Add Investment Amount (USD):</label>
        <input type="number" id="investment-input" min="5" step="1" required placeholder="Minimum $5" />
      </div>
      <button type="submit" class="button">Add Investment</button>
    </form>
    <ul class="investment-list" id="investment-history"></ul>
    <p id="investment-msg"></p>
  </section>

  <section id="deposit-withdraw-section" style="display:none;">
    <h2>Offline Deposit and Withdraw</h2>
    <div class="flex-row" style="gap: 2rem;">
      <form id="deposit-form" style="flex:1;">
        <h3>Deposit</h3>
        <div>
          <label for="deposit-amount">Amount (USD):</label>
          <input type="number" id="deposit-amount" min="1" step="0.01" required />
        </div>
        <div>
          <label for="deposit-method">Method:</label>
          <select id="deposit-method" required>
            <option value="">Select Method</option>
            <option value="paypal">PayPal</option>
            <option value="bkash">bKash</option>
          </select>
        </div>
        <div>
          <label for="deposit-transaction-id">Transaction ID / Details:</label>
          <textarea id="deposit-transaction-id" placeholder="Enter transaction details" required></textarea>
        </div>
        <button type="submit" class="button">Submit Deposit Request</button>
        <p id="deposit-msg"></p>
      </form>

      <form id="withdraw-form" style="flex:1;">
        <h3>Withdraw</h3>
        <div>
          <label for="withdraw-amount">Amount (USD):</label>
          <input type="number" id="withdraw-amount" min="1" step="0.01" required />
        </div>
        <div>
          <label for="withdraw-method">Method:</label>
          <select id="withdraw-method" required>
            <option value="">Select Method</option>
            <option value="paypal">PayPal</option>
            <option value="bkash">bKash</option>
          </select>
        </div>
        <button type="submit" class="button">Submit Withdraw Request</button>
        <p id="withdraw-msg"></p>
      </form>
    </div>
  </section>

  <section id="admin-panel-section" style="display:none;">
    <h2>Admin Panel</h2>
    <div class="tab-buttons">
      <button class="tab-button active" data-tab="deposits-tab">Deposit Requests</button>
      <button class="tab-button" data-tab="withdraws-tab">Withdraw Requests</button>
      <button class="tab-button" data-tab="users-tab">Users</button>
    </div>
    
    <div id="deposits-tab" class="tab-content">
      <h3>Pending Deposit Requests</h3>
      <ul class="admin-list" id="deposit-requests-list"></ul>
    </div>

    <div id="withdraws-tab" class="tab-content hidden">
      <h3>Pending Withdraw Requests</h3>
      <ul class="admin-list" id="withdraw-requests-list"></ul>
    </div>

    <div id="users-tab" class="tab-content hidden">
      <h3>Registered Users</h3>
      <ul class="admin-list" id="users-list"></ul>
    </div>
  </section>

</main>
<footer>
  &copy; 2024 Telegram Mini App. All rights reserved.
</footer>

<script>
  // Telegram login widget initialization
  // Use your actual bot username here:
  const telegramBotUsername = "YOUR_TELEGRAM_BOT_USERNAME";
  const telegramLoginDiv = document.getElementById('telegram-login');
  let currentUser = null;
  let userInvestments = [];
  let referralBonus = 0;
  let videoAdRewarded = false;
  let ppcClicks = 0;

  // Admin credentials (mock)
  const ADMIN_USERNAME = "admin";
  const ADMIN_PASSWORD = "admin123";

  // Utility: Display messages
  function showMessage(elem, msg, isError = false) {
    elem.textContent = msg;
    if(isError){
      elem.classList.add('error-msg');
      elem.classList.remove('success-msg');
    } else {
      elem.classList.add('success-msg');
      elem.classList.remove('error-msg');
    }
  }

  // Telegram login callback
  function onTelegramAuth(user) {
    currentUser = user;
    // Show user info and hide login button
    document.getElementById('login-section').querySelector('#telegram-login').style.display = 'none';
    document.getElementById('user-info').style.display = 'block';
    document.getElementById('user-name').textContent = user.first_name + (user.last_name ? " " + user.last_name : "");
    document.getElementById('user-id').textContent = user.id;

    // Set referral link - for demo, simply http host + ?ref=userId
    const referralLinkInput = document.getElementById('referral-link');
    referralLinkInput.value = window.location.origin + window.location.pathname + "?ref=" + user.id;

    // Referral bonus (mock)
    referralBonus = getReferralBonus(user.id);
    updateBonusInfo();

    showAppSections();

    console.log("Logged in user:", user);
  }

  // Telegram login widget embed
  function renderTelegramLoginButton() {
    telegramLoginDiv.innerHTML = '';
    let script = document.createElement('script');
    script.src = "https://telegram.org/js/telegram-widget.js?15";
    script.setAttribute('data-telegram-login', telegramBotUsername);
    script.setAttribute('data-size', 'large');
    script.setAttribute('data-userpic', 'false');
    script.setAttribute('data-auth-url', window.location.href);
    script.setAttribute('data-request-access', 'write');
    script.setAttribute('data-on-auth', 'onTelegramAuthCallback');
    telegramLoginDiv.appendChild(script);
  }

  // This function will be called by telegram widget on successful login
  window.onTelegramAuthCallback = function(user) {
    onTelegramAuth(user);
  };

  // Logout function
  document.getElementById('logout-btn').addEventListener('click', () => {
    currentUser = null;
    referralBonus = 0;
    userInvestments = [];
    videoAdRewarded = false;
    ppcClicks = 0;
    // Reset UI
    document.getElementById('login-section').querySelector('#telegram-login').style.display = 'flex';
    document.getElementById('user-info').style.display = 'none';
    hideAppSections();
    clearMessages();
    renderTelegramLoginButton();
  });

  // Referral bonus mock function
  // In real app, fetch from backend
  function getReferralBonus(userId) {
    // mock: random between 0-50
    return Math.floor(Math.random()*51);
  }
  function updateBonusInfo() {
    document.getElementById('bonus-info').textContent = "Your referral bonus: $" + referralBonus.toFixed(2);
  }

  // Show app main sections after login
  function showAppSections() {
    document.getElementById('video-ads-section').style.display = 'block';
    document.getElementById('pay-per-click-section').style.display = 'block';
    document.getElementById('investment-section').style.display = 'block';
    document.getElementById('deposit-withdraw-section').style.display = 'block';

    // Show admin panel if current user is admin (for demo matched by fixed username)
    if(currentUser && (currentUser.username === ADMIN_USERNAME)){
      document.getElementById('admin-panel-section').style.display = 'block';
      loadAdminData();
    } else {
      document.getElementById('admin-panel-section').style.display = 'none';
    }
  }
  // Hide all main sections except login
  function hideAppSections() {
    document.getElementById('video-ads-section').style.display = 'none';
    document.getElementById('pay-per-click-section').style.display = 'none';
    document.getElementById('investment-section').style.display = 'none';
    document.getElementById('deposit-withdraw-section').style.display = 'none';
    document.getElementById('admin-panel-section').style.display = 'none';
  }
  // Clear message texts
  function clearMessages() {
    ['ad-reward-msg','ppc-reward-msg','investment-msg','deposit-msg','withdraw-msg'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.textContent = '';
    });
  }

  // VIDEO ADS REWARDS

  // YouTube player API integration to detect video end
  let player;
  let watchAdButton = document.getElementById('watch-ad-btn');
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('video-iframe', {
      events: {
        'onStateChange': onPlayerStateChange
      }
    });
  }
  function onPlayerStateChange(event) {
    if(event.data === YT.PlayerState.ENDED) {
      watchAdButton.disabled = false;
    }
  }
  
  watchAdButton.addEventListener('click', () => {
    if (!videoAdRewarded) {
      videoAdRewarded = true;
      watchAdButton.disabled = true;
      showMessage(document.getElementById('ad-reward-msg'), 'You earned $0.50 for watching this ad!');
      // In real system send rewarded info to backend here
    } else {
      showMessage(document.getElementById('ad-reward-msg'), 'You have already earned reward for this ad.', true);
    }
  });

  // Load YouTube iframe API script
  let tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);

  // PAY PER CLICK REWARDS
  const ppcButtons = document.querySelectorAll('.ppc-ad-btn');
  ppcButtons.forEach(button => {
    button.addEventListener('click', () => {
      if(currentUser) {
        ppcClicks++;
        showMessage(document.getElementById('ppc-reward-msg'), `You earned $0.10 for clicking on an ad! Total clicks: ${ppcClicks}`);
        // Send click info to backend in real app
      }
    });
  });


  // WEEKLY INVESTMENT SYSTEM
  const investmentForm = document.getElementById('investment-form');
  const investmentAmountSpan = document.getElementById('investment-amount');
  const investmentHistoryList = document.getElementById('investment-history');
  const investmentMsg = document.getElementById('investment-msg');

  investmentForm.addEventListener('submit', e =>{
    e.preventDefault();
    let amount = parseFloat(investmentForm['investment-input'].value);
    if(amount < 5){
      showMessage(investmentMsg, 'Minimum investment is $5.', true);
      return;
    }
    userInvestments.push({
      id: Date.now(),
      amount,
      date: new Date().toLocaleDateString()
    });
    updateInvestmentUI();
    investmentForm.reset();
    showMessage(investmentMsg, `Invested $${amount.toFixed(2)} successfully!`);
    // Send investment info to backend here in real app
  });

  function updateInvestmentUI(){
    let total = userInvestments.reduce((acc,i) => acc + i.amount, 0);
    investmentAmountSpan.textContent = total.toFixed(2);
    investmentHistoryList.innerHTML = '';
    userInvestments.forEach(inv => {
      let li = document.createElement('li');
      li.textContent = `Invested $${inv.amount.toFixed(2)} on ${inv.date}`;
      investmentHistoryList.appendChild(li);
    });
  }


  // OFFLINE DEPOSIT & WITHDRAW SUBMISSION (mock sending)
  function mockApiCall(data) {
    return new Promise((res) => setTimeout(() => res({success:true}), 1000));
  }

  const depositForm = document.getElementById('deposit-form');
  const depositMsg = document.getElementById('deposit-msg');

  depositForm.addEventListener('submit', async e => {
    e.preventDefault();
    if(!currentUser){
      showMessage(depositMsg, 'Please login first.', true);
      return;
    }
    let data = {
      userId: currentUser.id,
      amount: parseFloat(depositForm['deposit-amount'].value),
      method: depositForm['deposit-method'].value,
      transactionId: depositForm['deposit-transaction-id'].value.trim(),
      type: 'deposit',
      date: new Date().toISOString()
    };
    if(!data.amount || data.amount <= 0 || !data.method || !data.transactionId){
      showMessage(depositMsg, 'All fields are required and amount must be positive.', true);
      return;
    }

    showMessage(depositMsg, 'Submitting deposit request...');
    let response = await mockApiCall(data);
    if(response.success){
      showMessage(depositMsg, 'Deposit request submitted for review.');
      depositForm.reset();
      loadAdminData(); // Refresh admin panel if shown
    } else {
      showMessage(depositMsg, 'Error submitting deposit request.', true);
    }
  });

  const withdrawForm = document.getElementById('withdraw-form');
  const withdrawMsg = document.getElementById('withdraw-msg');

  withdrawForm.addEventListener('submit', async e => {
    e.preventDefault();
    if(!currentUser){
      showMessage(withdrawMsg, 'Please login first.', true);
      return;
    }
    let data = {
      userId: currentUser.id,
      amount: parseFloat(withdrawForm['withdraw-amount'].value),
      method: withdrawForm['withdraw-method'].value,
      type: 'withdraw',
      date: new Date().toISOString()
    };
    if(!data.amount || data.amount <= 0 || !data.method){
      showMessage(withdrawMsg, 'All fields are required and amount must be positive.', true);
      return;
    }
    showMessage(withdrawMsg, 'Submitting withdraw request...');
    let response = await mockApiCall(data);
    if(response.success){
      showMessage(withdrawMsg, 'Withdraw request submitted for review.');
      withdrawForm.reset();
      loadAdminData();
    } else {
      showMessage(withdrawMsg, 'Error submitting withdraw request.', true);
    }
  });

  // ADMIN PANEL MOCK DATA & INTERACTIONS

  const depositRequestsList = document.getElementById('deposit-requests-list');
  const withdrawRequestsList = document.getElementById('withdraw-requests-list');
  const usersList = document.getElementById('users-list');

  // Mock storage for requests and users
  let mockDepositRequests = [];
  let mockWithdrawRequests = [];
  let mockUsers = [{id:1, username:"admin", first_name:"Admin", last_name:"User"}];

  // Loading admin data mock from local data
  function loadAdminData(){
    // For demo purpose, sync deposit/withdraw requests and user
    if(currentUser.username !== ADMIN_USERNAME) return;

    // Normally fetch from backend

    // Merge deposits and withdraws from mock storage
    depositRequestsList.innerHTML = '';
    mockDepositRequests.forEach(req => {
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${req.userId}</strong> requested deposit $${req.amount.toFixed(2)} via ${req.method} (Tx: ${req.transactionId})
        <button class="button admin-approve-btn" data-type="deposit" data-id="${req.id}" style="margin-left:1rem;">Approve</button>
        <button class="button" style="background:#c0392b;margin-left:0.4rem;" data-type="deposit" data-id="${req.id}">Reject</button>
      `;
      depositRequestsList.appendChild(li);
    });

    withdrawRequestsList.innerHTML = '';
    mockWithdrawRequests.forEach(req => {
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${req.userId}</strong> requested withdraw $${req.amount.toFixed(2)} via ${req.method}
        <button class="button admin-approve-btn" data-type="withdraw" data-id="${req.id}" style="margin-left:1rem;">Approve</button>
        <button class="button" style="background:#c0392b;margin-left:0.4rem;" data-type="withdraw" data-id="${req.id}">Reject</button>
      `;
      withdrawRequestsList.appendChild(li);
    });

    // Users list
    usersList.innerHTML = '';
    mockUsers.forEach(u => {
      const li = document.createElement('li');
      li.textContent = `[${u.id}] ${u.first_name} ${u.last_name} (@${u.username || 'no username'})`;
      usersList.appendChild(li);
    });
  }

  // Admin panel tab switching
  const tabButtons = document.querySelectorAll('.tab-button');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(btn.dataset.tab).classList.remove('hidden');
    });
  });

  // Admin approve/reject buttons behavior
  document.addEventListener('click', e => {
    if(e.target.classList.contains('admin-approve-btn')) {
      const id = e.target.dataset.id;
      const type = e.target.dataset.type;
      handleAdminRequestApprove(type, id);
    }
    if(e.target.dataset.type && e.target.textContent.toLowerCase().includes('reject')){
      const id = e.target.dataset.id;
      const type = e.target.dataset.type;
      handleAdminRequestReject(type, id);
    }
  });
  function handleAdminRequestApprove(type, id){
    if(type === 'deposit'){
      const index = mockDepositRequests.findIndex(req => req.id == id);
      if(index !== -1){
        mockDepositRequests.splice(index, 1);
        alert('Deposit request approved.');
      }
    } else if(type === 'withdraw'){
      const index = mockWithdrawRequests.findIndex(req => req.id == id);
      if(index !== -1){
        mockWithdrawRequests.splice(index, 1);
        alert('Withdraw request approved.');
      }
    }
    loadAdminData();
  }
  function handleAdminRequestReject(type, id){
    if(type === 'deposit'){
      const index = mockDepositRequests.findIndex(req => req.id == id);
      if(index !== -1){
        mockDepositRequests.splice(index, 1);
        alert('Deposit request rejected.');
      }
    } else if(type === 'withdraw'){
      const index = mockWithdrawRequests.findIndex(req => req.id == id);
      if(index !== -1){
        mockWithdrawRequests.splice(index, 1);
        alert('Withdraw request rejected.');
      }
    }
    loadAdminData();
  }

  // On page load
  renderTelegramLoginButton();

  // Check URL query params for referral
  function checkReferral() {
    let params = new URLSearchParams(window.location.search);
    let ref = params.get('ref');
    if(ref){
      showMessage(document.getElementById('bonus-info'), `You were referred by user ID: ${ref}. Referral bonuses will apply!`);
    }
  }
  checkReferral();

  // MOCK: initialize with some pending requests for admin demo
  mockDepositRequests = [
    {id: 1, userId: 123456, amount: 50, method: 'paypal', transactionId: 'PAYPAL123', date: '2024-06-01'},
    {id: 2, userId: 654321, amount: 35, method: 'bkash', transactionId: 'BKASH456', date: '2024-06-03'}
  ];
  mockWithdrawRequests = [
    {id: 1, userId: 123456, amount: 20, method: 'paypal', date: '2024-06-04'},
    {id: 2, userId: 654321, amount: 15, method: 'bkash', date: '2024-06-05'}
  ];
  mockUsers.push({id: 7890, username: 'johndoe', first_name: 'John', last_name: 'Doe'});

  
</script>
</body>
</html>

