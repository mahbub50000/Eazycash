<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Mini App - Rewards & Investment</title>
<script src='//libtl.com/sdk.js' data-zone='9497269' data-sdk='show_9497269'></script>
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>
<script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
          <script>
            window.TelegramAdsController = new TelegramAdsController();
            window.TelegramAdsController.initialize({
              pubId: "978207",
              appId: "2780",
            });
          </script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; font-family: 'Poppins', sans-serif;
    background: #fff;
    color: #333;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  #app {
    flex-grow:1;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 420px;
    margin: 0 auto;
    background: #fff9e6;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(255,215,0,0.3);
    overflow: hidden;
  }
  header {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 420px;
    padding: 20px;
    background: #ffeb3b;
    text-align: center;
    font-weight: 600;
    font-size: 1.5rem;
    letter-spacing: 1.2px;
    box-shadow: 0 4px 10px rgba(255,235,59,0.8);
    z-index: 1001;
    color: #333;
  }
  main {
    flex-grow: 1;
    padding: 80px 20px 110px 20px;
    overflow-y: auto;
  }
  footer {
    position: fixed;
    bottom: 0px;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 420px;
    display: flex;
    background: #fff9e6;
    box-shadow: 0 -6px 20px rgba(255,215,0,0.3);
    border-radius: 16px;
    z-index: 1000;
  }
  footer button {
    flex-grow: 1;
    padding: 6px 0;
    background: none;
    border: none;
    color: #666;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.3s, color 0.3s;
    position: relative;
  }
  @media (max-width: 400px) {
    header {
      font-size: 1.2rem;
      padding: 16px 12px;
    }
    main {
      padding: 70px 12px 12px 12px;
    }
    footer button {
      font-size: 0.8rem;
      padding: 5px 0;
    }
  }
  footer button:hover,
  footer button.active {
    color: #333;
    background: #fff176;
  }
  footer button svg {
    width: 24px; height: 24px;
    margin-bottom: 4px;
    fill: currentColor;
  }
  .hidden {
    display: none !important;
  }
  button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.3rem;
    margin-bottom: 16px;
    border-bottom: 2px solid #ffeb3b;
    padding-bottom: 6px;
    color: #333;
  }
  .card {
    background: #fffde7;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: inset 0 0 20px rgb(255,235,59, 0.6);
  }

  /* New styles for yellow column in referral and bonus cards */
  .yellow-column-container {
    display: flex;
    border-radius: 8px;
    overflow: hidden;
    font-weight: 700;
    font-size: 1.2rem;
    color: #333;
  }
  .yellow-column-label {
    background: #ffeb3b;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 140px;
  }
  .yellow-column-value {
    background: #fffde7;
    padding: 12px 20px;
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Set width for deposit and withdraw cards */
  #deposit-withdraw-section .card {
    width: 100%;
    max-width: 380px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    background: #fffde7;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: inset 0 0 20px rgb(255,235,59, 0.6);
  }
  
  /* Keep form elements and text left-aligned inside cards */
  #deposit-withdraw-section .card form,
  #deposit-withdraw-section .card h4,
  #deposit-withdraw-section .card table {
    text-align: left;
    color: #333;
  }
  .referral-link {
    background: #fff9e6;
    border-radius: 8px;
    padding: 10px;
    font-family: monospace;
    user-select: all;
    color: #333;
  }
  .copy-button {
    margin-top: 8px;
    padding: 8px 14px;
    background: #ffeb3b;
    border: none;
    border-radius: 6px;
    color: #333;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .copy-button:hover {
    background-color: #fbc02d;
  }
  input[type=number], input[type=text], select {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #ffeb3b;
    outline: none;
    margin-top: 8px;
    background: #fff;
    color: #333;
    transition: background-color 0.3s;
  }
  /* Change background color for deposit/withdraw method select */
  #deposit-method,
  #withdraw-method {
    background-color: #fbc02d !important;
  }
  input[type=number]:focus, input[type=text]:focus, select:focus {
    background: #fffde7;
    border-color: #fbc02d;
  }
  label {
    margin-top: 12px;
    font-weight: 600;
    color: #333;
  }
  .btn-primary {
    background: #ffeb3b;
    color:#333;
    border: none;
    border-radius: 10px;
    padding: 12px 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 16px;
    width: 100%;
    transition: background-color 0.3s;
  }
  .btn-primary:disabled {
    background: #fdd835;
    cursor: not-allowed;
  }
  .btn-primary:hover:not(:disabled) {
    background: #fbc02d;
  }
  /* Spin Wheel Styles */
  .spin-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .spin-wheel {
    position: relative;
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background: #fff9e6;
    margin: 20px auto;
    transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
    box-shadow: 0 0 30px rgba(251,192,45,0.8), inset 0 0 40px rgba(255,235,59,0.4);
    border: 8px solid #fbc02d;
    transform-origin: center;
  }

  .wheel-segment {
    position: absolute;
    width: 50%;
    height: 50%;
    transform-origin: 100% 100%;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    color: #333;
    padding-top: 20px;
    clip-path: polygon(100% 100%, 0 100%, 100% 0);
    background: linear-gradient(45deg, #ffeb3b, #fff176);
    border: 2px solid #fbc02d;
  }

  .wheel-segment:nth-child(2n) {
    background: linear-gradient(45deg, #fdd835, #ffeb3b);
  }
  
  .wheel-segment:nth-child(1) { transform: rotate(0deg); }
  .wheel-segment:nth-child(2) { transform: rotate(36deg); }
  .wheel-segment:nth-child(3) { transform: rotate(72deg); }
  .wheel-segment:nth-child(4) { transform: rotate(108deg); }
  .wheel-segment:nth-child(5) { transform: rotate(144deg); }
  .wheel-segment:nth-child(6) { transform: rotate(180deg); }
  .wheel-segment:nth-child(7) { transform: rotate(216deg); }
  .wheel-segment:nth-child(8) { transform: rotate(252deg); }
  .wheel-segment:nth-child(9) { transform: rotate(288deg); }
  .wheel-segment:nth-child(10) { transform: rotate(324deg); }
  
  .wheel-pointer {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 40px solid #f44336;
    z-index: 15;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  .wheel-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, #fbc02d, #ffeb3b);
    border-radius: 50%;
    border: 4px solid #f57f17;
    z-index: 20;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    color: #333;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  
  .spin-info {
    text-align: center;
    margin: 20px 0;
    padding: 15px;
    background: rgba(255,235,59,0.1);
    border-radius: 8px;
  }
  
  .spin-info div {
    margin: 8px 0;
    color: #333;
  }
  
  .spin-results {
    background: rgba(255,235,59,0.1);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }
  
  .spin-results h4 {
    margin: 0 0 10px 0;
    color: #fbc02d;
  }
  
  .results-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 8px;
    margin-top: 10px;
  }
  
  .result-item {
    background: #ffeb3b;
    color: #333;
    padding: 8px;
    border-radius: 6px;
    font-weight: 600;
    text-align: center;
    border: 1px solid #fbc02d;
  }
  .admin-section {
    background: #fff9e6;
    padding: 14px;
    border-radius: 12px;
  }
  .admin-controls label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    color: #333;
  }
  .admin-controls input[type=checkbox] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
  .toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: #fbc02d;
    color: #333;
    padding: 12px 24px;
    border-radius: 30px;
    box-shadow: 0 4px 20px rgba(251,192,45,0.9);
    font-weight: 600;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  .user-info {
    text-align: center;
    margin-bottom: 20px;
  }
  .user-info img {
    border-radius: 50%;
    width: 88px;
    height: 88px;
    border: 3px solid #ffeb3b;
    margin-bottom: 12px;
  }
  .user-info .username {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 4px;
    color: #333;
  }
  /* Total balance frame style */
  .total-balance-card {
    background: linear-gradient(135deg, #ffeb3b, #fbc02d);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 18px;
    box-shadow: 0 0 20px #fdd83577;
    text-align: center;
  }
  .total-balance-card .balance-label {
    font-size: 1rem;
    font-weight: 600;
    opacity: 0.85;
    margin-bottom: 6px;
    color: #333;
  }
  .total-balance-card .balance-amount {
    font-size: 2.2rem;
    font-weight: 800;
    color: #333;
  }
  /* Daily bonus UI */
  .daily-bonus {
    background: #fff9e6;
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 24px;
    text-align: center;
    box-shadow: 0 0 12px #fbc02daa;
  }
  .daily-bonus .bonus-amount {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: #fbc02d;
  }
  .daily-bonus .bonus-timer {
    font-size: 0.95rem;
    margin-bottom: 12px;
    opacity: 0.9;
    color: #333;
  }
  /* Referral card UI */
  .referral-card {
    background: #fff9e6;
    border-radius: 14px;
    padding: 16px;
    margin-top: 12px;
    box-shadow: 0 0 15px rgb(255,235,59,0.8);
  }

  /* Shape container for referral title */
  .referral-title-shape {
    display: inline-block;
    background: linear-gradient(135deg, #ffeb3b, #fbc02d);
    padding: 12px 24px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 16px;
    box-shadow: 0 4px 15px rgba(255,235,59,0.4);
    text-align: center;
    border: none;
  }

  /* Match Investment History section style to Deposit History section */
  #investment-history-table {
    width: 100%;
    color: #333;
    border-collapse: collapse;
  }
  #investment-history-table th,
  #investment-history-table td {
    padding: 8px;
    border-bottom: 1px solid #ffeb3b;
    text-align: left;
  }
  #investment-history-table thead tr th {
    border-bottom: 1px solid #ffeb3b;
  }
  #investment-history-table tbody tr td {
    border-bottom: 1px solid #ffeb3b;
  }
  /* Container div for investment history table */
  #investment-history-container {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ffeb3b;
    border-radius: 8px;
    padding: 8px;
  }

  /* Font size for Deposit and Withdraw History sections */
  #deposit-withdraw-section h4 {
    font-size: 1rem;
    color: #333;
  }
  #deposit-withdraw-section table,
  #deposit-withdraw-section th,
  #deposit-withdraw-section td {
    font-size: 1rem;
    color: #333;
  }

  /* Smaller font size for Investment History heading */
  #investment-section .card > h4 {
    font-size: 1rem;
    color: #333;
  }
  </style>
  <style>
    /* Notice Board Styles */
    .notice-board {
      display: flex;
      align-items: center;
      background: linear-gradient(135deg, #ffeb3b, #fbc02d);
      border-radius: 20px;
      padding: 10px 16px;
      margin-bottom: 18px;
      box-shadow: 0 0 20px #fdd835aa;
      overflow: hidden;
      position: relative;
      height: 40px;
    }
    .notice-icon {
      flex-shrink: 0;
      font-size: 24px;
      margin-right: 12px;
      color: #333;
      user-select: none;
    }
    .notice-text-container {
      flex-grow: 1;
      overflow: hidden;
      position: relative;
      height: 24px;
    }
.notice-text {
      white-space: nowrap;
      display: inline-block;
      color: #333;
      font-weight: 600;
      font-size: 1rem;
      animation: marquee 60s linear infinite;
      user-select: none;
    }
    @keyframes marquee {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
  </style>
</head>
<body>
<div id="app">
<header>
  Telegram Mini App
</header>
<main>
  <div id="login-section" class="">
    <!-- Telegram Login Widget placeholder -->
    <div style="text-align:center; margin-top:50px;">
      <img src="https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png" alt="Telegram" width="80" />
      <h2>Login with Telegram</h2>
      <button id="btn-tl-login" class="btn-primary">Simulate Telegram Login</button>
      <p>Click the button to simulate Telegram login (since API integration requires backend).</p>
    </div>
  </div>
    <section id="home-section" class="hidden">
    <div class="user-info">
      <img id="user-photo" src="" alt="User Photo" />
      <div class="username" id="user-name"></div>
      <div class="user-id" id="user-id" style="opacity:0.7; font-size:0.8rem;"></div>
    </div>

    <!-- Total Balance Card -->
    <div class="total-balance-card">
      <div class="balance-label">Total Balance</div>
      <div class="balance-amount" id="total-balance">0.00 BDT</div>
    </div>

    <!-- Notice Board Moving Text Panel -->
    <div class="notice-board">
      <div class="notice-icon" aria-hidden="true">⚠️</div>
      <div class="notice-text-container">
        <div class="notice-text" id="notice-text">No notices at the moment.</div>
      </div>
    </div>

    <!-- Notice Board Panel -->
    <!-- Removed redundant old notice board panel -->

    <!-- Daily Bonus Section -->
    <div class="daily-bonus">
      <div class="bonus-amount">Daily Bonus: +5 BDT</div>
      <div class="bonus-timer" id="daily-bonus-timer">Loading...</div>
      <button id="claim-daily-bonus" class="btn-primary" disabled>Claim Daily Bonus</button>
    </div>
    
    <!-- Referral Card UI -->
    <div class="referral-card">
      <div style="text-align: center; margin-bottom: 16px;">
        <span class="referral-title-shape">Referral & Bonus System</span>
      </div>
      <div>Your referral link:</div>
      <div class="referral-link" id="referral-link"></div>
      <button class="copy-button" id="copy-referral">Copy Referral Link</button>
    </div>
    <div style="display: flex; gap: 20px; margin-top: 20px;">
      <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 10px 12px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
        <h4 style="margin-bottom: 6px; font-size: 1.1rem;">Referral Count</h4>
        <div id="referral-count" style="font-size: 1.3rem; font-weight: 700; color: #333;">0</div>
      </div>
      <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 10px 12px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
        <h4 style="margin-bottom: 6px; font-size: 1.1rem;">Bonus Earned</h4>
        <div id="bonus-earned" style="font-size: 1.3rem; font-weight: 700; color: #333;">0.00 BDT</div>
      </div>
    </div>
    <div style="text-align:center; margin-top: 20px; font-weight: 600; font-size: 1.1rem; color: #ccc;">
      Eazycash@2025
    </div>
  </section>
  <section id="spin-section" class="hidden">
    <h3 class="section-title">Spin Rewards (10 Spins every hour)</h3>
    <div class="card">
      <div class="spin-container">
        <div class="spin-wheel" id="spin-wheel">
          <div class="wheel-segment" data-value="0.01">0.01</div>
          <div class="wheel-segment" data-value="0.05">0.05</div>
          <div class="wheel-segment" data-value="0.10">0.10</div>
          <div class="wheel-segment" data-value="0.20">0.20</div>
          <div class="wheel-segment" data-value="0.25">0.25</div>
          <div class="wheel-segment" data-value="0.30">0.30</div>
          <div class="wheel-segment" data-value="0.35">0.35</div>
          <div class="wheel-segment" data-value="0.40">0.40</div>
          <div class="wheel-segment" data-value="0.45">0.45</div>
          <div class="wheel-segment" data-value="0.50">0.50</div>
          <div class="wheel-center">SPIN</div>
        </div>
        <div class="wheel-pointer"></div>
      </div>
      
      <div style="display: flex; gap: 20px; margin-top: 20px; margin-bottom: 10px;">
        <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 6px 8px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
          <h4 style="margin-bottom: 4px; font-size: 1rem;">Spins Remaining</h4>
          <div id="spins-remaining" style="font-size: 1.1rem; font-weight: 700; color: #333;">10</div>
        </div>
        <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 6px 8px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
          <h4 style="margin-bottom: 4px; font-size: 1rem;">Total Rewards This Session</h4>
          <div id="session-rewards" style="font-size: 1.1rem; font-weight: 700; color: #333;">0</div> BDT
        </div>
      </div>
      <button id="spin-button" class="btn-primary" style="margin: 0 0 8px 0;">Spin the Wheel!</button>
      <div id="spin-timer" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
      
      <div class="spin-results" id="spin-results" style="margin-top: 16px; display: none;">
        <h4>Spin Results:</h4>
        <div id="results-list"></div>
      </div>
    </div>
    <div style="text-align:center; margin-top: 20px; font-weight: 600; font-size: 1.1rem; color: #ccc;">
      Eazycash@2025
    </div>
  </section>
    <section id="ppc-section" class="hidden">
    <div style="text-align: center; margin-bottom: 16px;">
      <span class="referral-title-shape">Pay Per Click Rewards (Claim every hour)</span>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-1" class="btn-primary">Claim PPC Reward #1</button>
      <div id="ppc-reward-timer-1" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-2" class="btn-primary">Claim PPC Reward #2</button>
      <div id="ppc-reward-timer-2" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-3" class="btn-primary">Claim PPC Reward #3</button>
      <div id="ppc-reward-timer-3" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-4" class="btn-primary">Claim PPC Reward #4</button>
      <div id="ppc-reward-timer-4" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-5" class="btn-primary">Claim PPC Reward #5</button>
      <div id="ppc-reward-timer-5" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-6" class="btn-primary">Claim PPC Reward #6</button>
      <div id="ppc-reward-timer-6" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-7" class="btn-primary">Claim PPC Reward #7</button>
      <div id="ppc-reward-timer-7" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-8" class="btn-primary">Claim PPC Reward #8</button>
      <div id="ppc-reward-timer-8" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-9" class="btn-primary">Claim PPC Reward #9</button>
      <div id="ppc-reward-timer-9" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div class="card">
      <button id="claim-ppc-reward-10" class="btn-primary">Claim PPC Reward #10</button>
      <div id="ppc-reward-timer-10" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
    </div>
    <div style="text-align:center; margin-top: 20px; font-weight: 600; font-size: 1.1rem; color: #ccc;">
      Eazycash@2025
    </div>
    
  </section>
  <section id="investment-section" class="hidden">
    <h3 class="section-title">Weekly Investment System</h3>
    <!-- Deposit Balance Card -->
    <div class="total-balance-card" style="margin-bottom: 20px;">
      <div class="balance-label">Deposit Balance</div>
      <div class="balance-amount" id="deposit-balance">0.00 BDT</div>
    </div>
    <!-- Investment Available Balance Card -->
    <div class="total-balance-card" style="margin-bottom: 20px; background: linear-gradient(135deg, #a5d6a7, #81c784);">
      <div class="balance-label">Investment Available Balance</div>
      <div class="balance-amount" id="investment-available-balance">0.00 BDT</div>
      <input type="number" id="transfer-to-investment-amount" min="0" step="0.01" placeholder="Enter amount to transfer" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: none; outline: none; background: rgba(255 255 255 / 0.1); color: #eee; margin-top: 8px; transition: background-color 0.3s;" />
      <button id="transfer-to-investment-btn" class="btn-primary" style="margin-top: 12px;">Transfer Deposit to Investment Available</button>
    </div>
    <div class="card" style="margin-bottom: 20px;">
      <label for="transfer-deposit-amount"></label>
      <input type="number" id="transfer-deposit-amount" min="0" step="0.01" placeholder="Enter amount" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: none; outline: none; background: rgba(255 255 255 / 0.1); color: #eee; transition: background-color 0.3s;" />
      <button id="transfer-deposit-btn" class="btn-primary" style="margin-top: 12px;">Transfer Deposit to Main Balance</button>

      <label for="transfer-main-amount" style="margin-top: 20px; display: block;"></label>
      <input type="number" id="transfer-main-amount" min="0" step="0.01" placeholder="Enter amount" style="width: 100%; padding: 10px 12px; border-radius: 8px; border: none; outline: none; background: rgba(255 255 255 / 0.1); color: #eee; transition: background-color 0.3s;" />
      <button id="transfer-main-btn" class="btn-primary" style="margin-top: 12px;">Transfer Main to Deposit</button>
    </div>
    <div class="card">
      <label for="investment-amount">Select Investment Amount (BDT):</label>
      <select id="investment-amount">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="250">250</option>
      </select>
      <button id="invest-btn" class="btn-primary">Invest Now</button>
      <!-- Removed old current investment display as per user request -->
      <!-- <div style="margin-top: 12px;">
        <strong>Your Current Investment:</strong> <span id="current-investment">0</span> BDT
      </div> -->
        <div style="margin-top: 16px; padding: 12px; background: rgba(255,235,59,0.1); border-radius: 8px; font-size: 0.9rem;">
        <strong>Investment Note:</strong><br>
        • Investment Period: 7 days<br>
        • Example: Invest 100 BDT → Get 20 BDT bonus after 7 days (Total return: 120 BDT)
      </div>
    </div>
    <!-- Investment Balance and Profit Table -->
    <div style="display: flex; gap: 20px; margin-top: 20px;">
      <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 16px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
        <h4>Investment Balance</h4>
        <div id="investment-balance" style="font-size: 1.5rem; font-weight: 700; color: #333;">0.00 BDT</div>
      </div>
      <div class="card" style="flex: 1; text-align: center; box-shadow: 0 0 20px #fdd83577; border-radius: 14px; padding: 16px; background: linear-gradient(135deg, #ffeb3b, #fbc02d);">
        <h4>Profit Balance</h4>
        <div id="profit-balance" style="font-size: 1.5rem; font-weight: 700; color: #333;">0.00 BDT</div>
      </div>
    </div>
    <!-- Investment History Section -->
    <div class="card" style="margin-top: 20px;">
      <h4>Investment History</h4>
      <div id="investment-history-container">
        <table id="investment-history-table" style="width: 100%; color: #333; border-collapse: collapse;">
          <thead>
            <tr>
          <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">Date</th>
          <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">Amount (BDT)</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">Days Remaining</th>
          <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">Status</th>
            </tr>
          </thead>
          <tbody id="investment-history-body">
            <!-- Investment history rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
    <div style="text-align:center; margin-top: 20px; font-weight: 600; font-size: 1.1rem; color: #ccc;">
      Eazycash@2025
    </div>
    
   </section>
    <section id="deposit-withdraw-section" class="hidden" style="padding: 20px;">
    
    <!-- Separate Deposit Card -->
      <div class="card" style="margin-bottom: 20px;">
      <div style="text-align: center; margin-bottom: 16px;">
        <h4 style="display: inline-block; background: linear-gradient(135deg, #ffeb3b, #fbc02d); padding: 12px 24px; border-radius: 25px; font-weight: bold; font-size: 1.4rem; color: #333; margin: 0; box-shadow: 0 4px 15px rgba(255,235,59,0.4);">Deposit</h4>
      </div>
      <div class="notice-board" style="margin-bottom: 16px; height: auto; padding: 12px 16px; border-radius: 20px; box-shadow: 0 0 20px #fdd835aa; background: linear-gradient(135deg, #ffeb3b, #fbc02d); color: #333; font-weight: 600; font-size: 1rem; display: flex; align-items: center;">
        <div class="notice-icon" aria-hidden="true" style="font-size: 24px; margin-right: 12px; user-select: none;">⚠️</div>
        <div style="flex-grow: 1; white-space: normal;">
          Deposit Note: Payment to (Bkash No: 01680155231 - Select: bKash Payment Option). After Payment Input Amount & Transaction Number. At last Click (Submit Deposit Request).
        </div>
      </div>
      <form id="deposit-form">
        <label for="deposit-method">Deposit Method:</label>
        <select id="deposit-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="deposit-amount">Amount (BDT):</label>
        <input type="number" id="deposit-amount" min="1" required />
        <label for="deposit-reference">Transaction Reference:</label>
        <input type="text" id="deposit-reference" placeholder="Transaction ID or Details" required />
        <button type="submit" class="btn-primary">Submit Deposit Request</button>
      </form>
      <!-- Deposit History Table -->
      <div style="margin-top: 20px;">
        <h4>Deposit History</h4>
        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ffeb3b; border-radius: 8px; padding: 8px;">
        <table style="width: 100%; color: #333; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Date</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Amount (BDT)</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Method</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Status</th>
            </tr>
          </thead>
          <tbody id="deposit-history-body">
            <!-- Deposit history rows will be inserted here -->
          </tbody>
        </table>
        </div>
      </div>
    </div>
    <div class="card" style="margin-top: 20px;">
      <div style="text-align: center; margin-bottom: 16px;">
        <h4 style="display: inline-block; background: linear-gradient(135deg, #ffeb3b, #fbc02d); padding: 12px 24px; border-radius: 25px; font-weight: bold; font-size: 1.4rem; color: #333; margin: 0; box-shadow: 0 4px 15px rgba(255,235,59,0.4);">Withdraw</h4>
      </div>
      <form id="withdraw-form">
        <label for="withdraw-method">Withdraw Method:</label>
        <select id="withdraw-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="withdraw-amount">Amount (BDT):</label>
        <input type="number" id="withdraw-amount" min="1" required />
        <label for="withdraw-address">Withdrawal Address / Info:</label>
        <input type="text" id="withdraw-address" placeholder="Your PayPal or bKash Info" required />
        <button type="submit" class="btn-primary">Submit Withdraw Request</button>
      </form>
      <!-- Withdraw History Table -->
      <div style="margin-top: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #ffeb3b; border-radius: 8px; padding: 8px;">
        <h4>Withdraw History</h4>
        <table style="width: 100%; color: #333; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Date</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Amount (BDT)</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Method</th>
              <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ffeb3b;">Status</th>
            </tr>
          </thead>
          <tbody id="withdraw-history-body">
            <!-- Withdraw history rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </div>
    <div style="text-align:center; margin-top: 20px; font-weight: 600; font-size: 1.1rem; color: #ccc;">
      Eazycash@2025
    </div>
  </section>
  <section id="admin-section" class="hidden admin-section">
    <h3 class="section-title">Admin Panel</h3>
    <div class="admin-controls">
      <label>
        <input type="checkbox" id="toggle-deposit-enabled" /> Deposits Enabled
      </label>
      <label>
        <input type="checkbox" id="toggle-withdraw-enabled" /> Withdrawals Enabled
      </label>
    </div>
  </section>
</main>
<footer>
  <button id="nav-home" class="active" aria-label="Home" title="Home">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    Home
  </button>
  <button id="nav-spin" aria-label="Spin" title="Spin">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
    Spin
  </button>
  <button id="nav-ppc" aria-label="PPC Rewards" title="PPC Rewards">
    <svg viewBox="0 0 24 24"><path d="M13 17h-2v-2h2v2zm0-6h-2v-2h2v2zm4 4h-2v-2h2v2zm-8 0H7v-2h2v2zm8-4h-2V9h2v2zm-4 8c3.31 0 6-2.69 6-6h-2a4 4 0 01-4 4v2zm-6-6a6 6 0 0111.9-1h-2A4 4 0 009 13v2H7v-2z"/></svg>
    PPC
  </button>
  <button id="nav-investment" aria-label="Investment" title="Investment">
    <!-- Investment icon: upward trend chart -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M4 17h16v2H4v-2zm2-5h3v5H6v-5zm5-4h3v9h-3V8zm5-3h3v12h-3V5z"/></svg>
    Invest
  </button>
  <button id="nav-deposit" aria-label="Wallet" title="Wallet">
    <!-- Wallet icon -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M21 7H3c-.55 0-1 .45-1 1v8a3 3 0 0 0 3 3h13c1.1 0 2-.9 2-2v-8c0-.55-.45-1-1-1zm-7 5a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/></svg>
    Wallet
  </button>
  <button id="nav-admin" aria-label="Admin Panel" title="Admin Panel" class="hidden">
    <svg viewBox="0 0 24 24"><path d="M12 2L2 7v6c0 5 4 9 10 9s10-4 10-9V7l-10-5zm0 4l6 3.5v5L12 17l-6-2.5v-5L12 6z"/></svg>
     Admin
   </button>
</footer>
</div>

<div id="toast" class="toast">Message</div>

<script>
    (() => {
    const userDataKey = 'telegramMiniAppUser';
    const referralBaseURL = 'https://t.me/your_bot?start=';
    const referralBonusPerReferral = 1.5; // BDT coins per referral
    const dailyBonusAmount = 5; // Daily bonus amount BDT
    const videoRewardAmount = 2.5; // BDT per video ad claim
    const ppcRewardAmount = 1.2; // BDT per PPC claim
    // Reward claim cooldowns in ms
    const rewardCooldown = 1000 * 60 * 60; // 1 hour cooldown
    const dailyBonusCooldown = 1000 * 60 * 60 * 24; // 24 hours for daily bonus

    // Admin settings and state
    const ADMIN_SETTINGS_KEY = 'adminSettings';
    
    // State
    let user = null;
    let referrals = []; // Array of user ids who used referral link
    let dailyClaimBonus = 0;
    let referralBonus = 0;
    let spinRewards = 0;
    let ppcRewards = 0;
    let currentInvestment = 0;
    let depositEnabled = true;
    let withdrawEnabled = true;
    let registrationsEnabled = true;
    let rewardsEnabled = true;

    // Define bonus as sum of dailyClaimBonus and referralBonus
    let bonus = 0;

    // Function to update bonus as sum of dailyClaimBonus and referralBonus
    function updateBonus() {
      bonus = dailyClaimBonus + referralBonus;
    }


    // Load admin settings
    function loadAdminSettings() {
      const settings = localStorage.getItem(ADMIN_SETTINGS_KEY);
      if (settings) {
        try {
          const adminSettings = JSON.parse(settings);
          depositEnabled = adminSettings.depositsEnabled;
          withdrawEnabled = adminSettings.withdrawalsEnabled;
          registrationsEnabled = adminSettings.registrationsEnabled;
          rewardsEnabled = adminSettings.rewardsEnabled;
        } catch (e) {
          console.error('Error loading admin settings:', e);
        }
      }
    }

    // Elements
    const loginSection = document.getElementById('login-section');
    const homeSection = document.getElementById('home-section');
    const spinSection = document.getElementById('spin-section');
    const ppcSection = document.getElementById('ppc-section');
    const investmentSection = document.getElementById('investment-section');
    const depositWithdrawSection = document.getElementById('deposit-withdraw-section');
    const adminSection = document.getElementById('admin-section');

    const navButtons = {
      home: document.getElementById('nav-home'),
      spin: document.getElementById('nav-spin'),
      ppc: document.getElementById('nav-ppc'),
      investment: document.getElementById('nav-investment'),
      deposit: document.getElementById('nav-deposit'),
      admin: document.getElementById('nav-admin')
    };

    const userPhotoEl = document.getElementById('user-photo');
    const userNameEl = document.getElementById('user-name');
    const userIdEl = document.getElementById('user-id');

    const referralLinkEl = document.getElementById('referral-link');
    const referralCountEl = document.getElementById('referral-count');
    const bonusEarnedEl = document.getElementById('bonus-earned');

    const copyReferralBtn = document.getElementById('copy-referral');

    // Spin wheel elements
    const spinWheel = document.getElementById('spin-wheel');
    const spinButton = document.getElementById('spin-button');
    const spinTimer = document.getElementById('spin-timer');
    const spinsRemainingEl = document.getElementById('spins-remaining');
    const sessionRewardsEl = document.getElementById('session-rewards');
    const spinResults = document.getElementById('spin-results');
    const resultsList = document.getElementById('results-list');
    
    // Spin wheel variables
    let spinsRemaining = 10;
    let sessionRewards = 0;
    let isSpinning = false;

    const claimPpcRewardBtns = [
      document.getElementById('claim-ppc-reward-1'),
      document.getElementById('claim-ppc-reward-2'),
      document.getElementById('claim-ppc-reward-3'),
      document.getElementById('claim-ppc-reward-4'),
      document.getElementById('claim-ppc-reward-5'),
      document.getElementById('claim-ppc-reward-6'),
      document.getElementById('claim-ppc-reward-7'),
      document.getElementById('claim-ppc-reward-8'),
      document.getElementById('claim-ppc-reward-9'),
      document.getElementById('claim-ppc-reward-10')
    ];
    const ppcRewardTimers = [
      document.getElementById('ppc-reward-timer-1'),
      document.getElementById('ppc-reward-timer-2'),
      document.getElementById('ppc-reward-timer-3'),
      document.getElementById('ppc-reward-timer-4'),
      document.getElementById('ppc-reward-timer-5'),
      document.getElementById('ppc-reward-timer-6'),
      document.getElementById('ppc-reward-timer-7'),
      document.getElementById('ppc-reward-timer-8'),
      document.getElementById('ppc-reward-timer-9'),
      document.getElementById('ppc-reward-timer-10')
    ];

    const investmentAmountSel = document.getElementById('investment-amount');
    const investBtn = document.getElementById('invest-btn');
    const currentInvestmentEl = document.getElementById('current-investment');

    const depositForm = document.getElementById('deposit-form');
    const withdrawForm = document.getElementById('withdraw-form');

    const depositMethodSelect = document.getElementById('deposit-method');
    const withdrawMethodSelect = document.getElementById('withdraw-method');

    const depositAmountInput = document.getElementById('deposit-amount');
    const depositReferenceInput = document.getElementById('deposit-reference');

    const withdrawAmountInput = document.getElementById('withdraw-amount');
    const withdrawAddressInput = document.getElementById('withdraw-address');

    const toggleDepositEnabled = document.getElementById('toggle-deposit-enabled');
    const toggleWithdrawEnabled = document.getElementById('toggle-withdraw-enabled');

    const toastEl = document.getElementById('toast');

    // New daily bonus elements
    const dailyBonusTimerEl = document.getElementById('daily-bonus-timer');
    const claimDailyBonusBtn = document.getElementById('claim-daily-bonus');
    const totalBalanceEl = document.getElementById('total-balance');

    // Utility for toast message
    function showToast(msg, duration=3000) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => {
        toastEl.classList.remove('show');
      }, duration);
    }

    // Save user data and state to localStorage
    function saveUserData() {
      if (user) {
        const userData = {
          user,
          referrals,
          dailyClaimBonus,
          referralBonus,
          spinRewards,
          ppcRewards,
          currentInvestment,
          lastSpinClaim: parseInt(localStorage.getItem('lastSpinClaim')) || 0,
          lastPpcClaim: parseInt(localStorage.getItem('lastPpcClaim')) || 0,
          depositEnabled,
          withdrawEnabled,
          lastDailyBonusClaim: parseInt(localStorage.getItem('lastDailyBonusClaim')) || 0,
          lastActive: Date.now()
        };
        
        localStorage.setItem(userDataKey, JSON.stringify(userData));
        
        // Update registered users list for admin panel
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        const existingUserIndex = registeredUsers.findIndex(u => u.id === user.id);
        
        if (existingUserIndex !== -1) {
          // Update existing user
          registeredUsers[existingUserIndex] = {
            ...registeredUsers[existingUserIndex],
            lastActive: Date.now(),
            lastLogin: Date.now()
          };
        } else {
          // Add new user
          registeredUsers.push({
            id: user.id,
            first_name: user.first_name,
            last_name: user.last_name,
            username: user.username,
            registeredAt: Date.now(),
            lastActive: Date.now(),
            lastLogin: Date.now()
          });
        }
        
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
      }
    }

    // Load user data from localStorage
    function loadUserData() {
      const saved = localStorage.getItem(userDataKey);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          user = data.user || null;
          referrals = data.referrals || [];
          dailyClaimBonus = data.dailyClaimBonus || 0;
          referralBonus = data.referralBonus || 0;
          spinRewards = data.spinRewards || 0;
          ppcRewards = data.ppcRewards || 0;
          currentInvestment = data.currentInvestment || 0;
          depositEnabled = data.depositEnabled !== undefined ? data.depositEnabled : true;
          withdrawEnabled = data.withdrawEnabled !== undefined ? data.withdrawEnabled : true;

          // Update bonus after loading user data
          updateBonus();

          return true;
        } catch {
          return false;
        }
      }
      return false;
    }

    // Format time left in h:mm:ss
    function formatTimeLeft(ms) {
      if (ms <= 0) return 'Ready to claim';
      const totalSeconds = Math.floor(ms / 1000);
      const h = Math.floor(totalSeconds / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      const s = totalSeconds % 60;
      return `${h ? h + 'h ' : ''}${m}m ${s}s`;
    }

    // Check if user is admin (using admin session)
    function isAdmin() {
      const adminSession = localStorage.getItem('adminSession');
      if (!adminSession) return false;
      
      try {
        const sessionData = JSON.parse(adminSession);
        const now = Date.now();
        const sessionAge = now - sessionData.timestamp;
        const maxAge = 24 * 60 * 60 * 1000; // 24 hours
        return sessionAge < maxAge;
      } catch {
        return false;
      }
    }

    // Render user info and UI parts according to user state
    function renderUI() {
      if (!user) {
        loginSection.classList.remove('hidden');
        homeSection.classList.add('hidden');
        spinSection.classList.add('hidden');
        ppcSection.classList.add('hidden');
        investmentSection.classList.add('hidden');
        depositWithdrawSection.classList.add('hidden');
        adminSection.classList.add('hidden');
        navButtons.admin.classList.add('hidden');
        return;
      }
      loginSection.classList.add('hidden');
      // Show home section and other sections as per nav
      navButtons.admin.classList.toggle('hidden', !isAdmin());

      // Show the first active content (home)
      showSection('home');

      // Update user info display
      userPhotoEl.src = user.photo_url || 'https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png';
      userNameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      userIdEl.textContent = "User ID: " + user.id;

      referralLinkEl.textContent = referralBaseURL + user.id;
      referralCountEl.textContent = referrals.length;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);

      // Total Balance = bonus + spinRewards + ppcRewards
      const totalBalance = bonus + spinRewards + ppcRewards;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';

      // Set deposit/withdraw enable switches in admin panel
      toggleDepositEnabled.checked = depositEnabled;
      toggleWithdrawEnabled.checked = withdrawEnabled;

      // Enable or disable deposit/withdraw forms based on admin control
      depositMethodSelect.disabled = !depositEnabled;
      depositAmountInput.disabled = !depositEnabled;
      depositReferenceInput.disabled = !depositEnabled;
      depositForm.querySelector('button[type="submit"]').disabled = !depositEnabled;

      withdrawMethodSelect.disabled = !withdrawEnabled;
      withdrawAmountInput.disabled = !withdrawEnabled;
      withdrawAddressInput.disabled = !withdrawEnabled;
      withdrawForm.querySelector('button[type="submit"]').disabled = !withdrawEnabled;

      // Update reward buttons cooldown timers
      updateRewardButtons();

      // Update daily bonus state UI
      updateDailyBonusUI();
    }

    // Show only one main section at a time
    function showSection(sectionName) {
      const sections = {
        home: homeSection,
        spin: spinSection,
        ppc: ppcSection,
        investment: investmentSection,
        deposit: depositWithdrawSection,
        admin: adminSection
      };
      Object.entries(sections).forEach(([key, el]) => {
        el.classList.toggle('hidden', key !== sectionName);
      });
      // Set active nav button
      Object.entries(navButtons).forEach(([key, btn]) => {
        btn.classList.toggle('active', key === sectionName);
      });
    }

    // Navigation buttons listeners
    Object.entries(navButtons).forEach(([key, btn]) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first.');
          return;
        }
        showSection(key);
        // Ensure active class toggling is correct
        Object.entries(navButtons).forEach(([k, b]) => {
          b.classList.toggle('active', k === key);
        });
      });
    });

    // Copy referral link
    copyReferralBtn.addEventListener('click', () => {
      if (!navigator.clipboard) {
        showToast('Clipboard not supported');
        return;
      }
      navigator.clipboard.writeText(referralLinkEl.textContent)
        .then(() => showToast('Referral link copied!'))
        .catch(() => showToast('Failed to copy'));
    });

    // Handle Telegram login simulation
    document.getElementById('btn-tl-login').addEventListener('click', () => {
      if (!registrationsEnabled) {
        showToast('New registrations are currently disabled by admin.');
        return;
      }
      // Simulate login and store user data
      // Normally you get this data from Telegram widget with backend token check
      const simulatedUser = {
        id: Math.floor(Math.random() * 1000000) + 10000,
        first_name: 'Demo',
        last_name: 'User',
        username: 'demouser',
        photo_url: 'https://randomuser.me/api/portraits/lego/5.jpg'
      };
      setUser(simulatedUser);
    });

    // Set user after login
    function setUser(newUser) {
      user = newUser;
      // Check if this user came from referral param in URL (simulate it)
      const urlParams = new URLSearchParams(window.location.search);
      const referralId = urlParams.get('start'); // Telegram passes referral as ?start=...
      if (referralId && referralId != user.id.toString()) {
        // Add referral if not already
        if (!referrals.includes(referralId)) {
          referrals.push(referralId);
          referralBonus += referralBonusPerReferral;
          showToast(`Referral bonus added: +${referralBonusPerReferral} BDT`);
        }
      }
      saveUserData();
      renderUI();
      showToast('Logged in as ' + user.first_name);
    }

    // Reward claim timers
    function canClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      return now - lastClaim >= cooldown;
    }
    function timeToNextClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      const diff = cooldown - (now - lastClaim);
      return diff > 0 ? diff : 0;
    }


// In-App Interstitial

show_9497269({
  type: 'inApp',
  inAppSettings: {
    frequency: 2,
    capping: 0.1,
    interval: 30,
    timeout: 5,
    everyPage: false
  }
})

/*
This value is decoded as follows:
- show automatically 2 ads
  within 0.1 hours (6 minutes)
  with a 30-second interval between them
  and a 5-second delay before the first one is shown.
  The last digit, 0, means that the session will be saved when you navigate between pages.
  If you set the last digit as 1, then at any transition between pages,
  the session will be reset, and the ads will start again.
*/



const AdController = window.Adsgram.init({ blockId: "12351" });

// Show interstitial ad automatically after 8 minutes (480000 ms)
setTimeout(() => {
  AdController.show().then((result) => {
    // user watched ad till the end or closed it in interstitial format
    // your code to reward user for rewarded format
  }).catch((result) => {
    // user got error during playing ad or closed early
    // do nothing or handle as needed
  });
}, 480000);


    // Spin wheel functionality
    function spinTheWheel() {
      if (isSpinning) return;
      
      if (!user) {
        showToast('Please login first');
        return;
      }
      
      if (!rewardsEnabled) {
        showToast('Rewards are currently disabled by admin.');
        return;
      }
      
      if (!canClaim('lastSpinClaim', rewardCooldown)) {
        showToast('Please wait for the cooldown to finish.');
        return;
      }
      
      if (spinsRemaining <= 0) {
        showToast('No spins remaining. Please wait for the next hour.');
        return;
      }
      
      isSpinning = true;
      spinButton.disabled = true;

      // Show adsgram interstitial ad before spinning
      AdController.show().then(() => {
        // Ad watched or closed, proceed with spin
        proceedSpin();
      }).catch(() => {
        // Ad failed or skipped, still proceed with spin
        proceedSpin();
      });

      function proceedSpin() {
        // Clear previous results if all 10 spins were used
        if (spinsRemaining === 10) {
          resultsList.innerHTML = '';
          sessionRewards = 0;
          sessionRewardsEl.textContent = '0';
          spinResults.style.display = 'block';
        }
        
        // Random rotation between 1440 and 2160 degrees (4-6 full spins) plus segment
        const extraSpins = Math.floor(Math.random() * 2 + 4) * 360;
        const segmentCount = 10;
        const segmentAngle = Math.floor(Math.random() * segmentCount) * (360 / segmentCount);
        const totalRotation = extraSpins + segmentAngle;
        
        // Reset any previous rotation first
        spinWheel.style.transition = 'none';
        spinWheel.style.transform = 'rotate(0deg)';
        // Force reflow
        spinWheel.offsetHeight;
        // Add smooth transition back and spin
        spinWheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
        spinWheel.style.transform = `rotate(-${totalRotation}deg)`;
        
        setTimeout(() => {
          // Calculate reward based on segment landed on
          const segmentIndex = Math.floor(segmentAngle / (360 / segmentCount));
          const rewards = [0.01, 0.05, 0.10, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50];
          const reward = rewards[segmentIndex];
          
          // Add result to list
          const resultItem = document.createElement('div');
          resultItem.className = 'result-item';
          resultItem.textContent = `${reward.toFixed(2)} BDT`;
          resultsList.appendChild(resultItem);
          
          // Update session rewards
          sessionRewards += reward;
          sessionRewardsEl.textContent = sessionRewards.toFixed(2);
          
          // Update total rewards
          spinRewards += reward;
          saveUserData();
          
          // Update spins remaining
          spinsRemaining--;
          spinsRemainingEl.textContent = spinsRemaining;
          
          if (spinsRemaining === 0) {
            // All spins used, start cooldown
            localStorage.setItem('lastSpinClaim', Date.now().toString());
            showToast(`Session complete! Total rewards: ${sessionRewards.toFixed(2)} BDT`);
          } else {
            showToast(`You won ${reward.toFixed(2)} BDT! ${spinsRemaining} spins remaining`);
          }
          
          isSpinning = false;
          spinButton.disabled = false;
          updateTotalBalance();
        }, 3000);
      }
    }
    
    // Add spin button event listener
    spinButton.addEventListener('click', spinTheWheel);

    // Claim PPC reward handlers for all 10 buttons
    claimPpcRewardBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first');
          return;
        }
        if (!rewardsEnabled) {
          showToast('Rewards are currently disabled by admin.');
          return;
        }
        const ppcClaimKey = `lastPpcClaim${index + 1}`;
        if (!canClaim(ppcClaimKey, rewardCooldown)) {
          showToast(`PPC reward #${index + 1} already claimed. Please wait.`);
          return;
        }
        if (index < 5) {
          // First 5 buttons: Rewarded Popup
          show_9497269('pop').then(() => {
            btn.disabled = true;
            showToast(`Processing PPC claim #${index + 1}...`);
            setTimeout(() => {
              ppcRewards += ppcRewardAmount;
              localStorage.setItem(ppcClaimKey, Date.now().toString());
              saveUserData();
              updateRewardButtons();
              showToast(`You earned +${ppcRewardAmount} BDT from PPC #${index + 1}!`);
              btn.disabled = false;
              bonus = dailyClaimBonus + referralBonus;
              bonusEarnedEl.textContent = bonus.toFixed(2);
              updateTotalBalance();
            }, 3000);
          }).catch(e => {
            // user get error during playing ad
            // do nothing or whatever you want
          });
        } else {
          // Last 5 buttons: Monetag In-App Interstitial ad
          if (typeof show_9497269 === 'function') {
            show_9497269({
              type: 'inApp',
              inAppSettings: {
                frequency: 1,
                capping: 0,
                interval: 500,
                timeout: 0,
                everyPage: false
              }
            }).then(() => {
              btn.disabled = true;
              showToast(`Processing PPC claim #${index + 1}...`);
              setTimeout(() => {
                ppcRewards += ppcRewardAmount;
                localStorage.setItem(ppcClaimKey, Date.now().toString());
                saveUserData();
                updateRewardButtons();
                showToast(`You earned +${ppcRewardAmount} BDT from PPC #${index + 1}!`);
                btn.disabled = false;
                bonus = dailyClaimBonus + referralBonus;
                bonusEarnedEl.textContent = bonus.toFixed(2);
                updateTotalBalance();
              }, 3000);
            }).catch(() => {
              // Ad failed or skipped, still proceed with reward
              btn.disabled = true;
              showToast(`Processing PPC claim #${index + 1}...`);
              setTimeout(() => {
                ppcRewards += ppcRewardAmount;
                localStorage.setItem(ppcClaimKey, Date.now().toString());
                saveUserData();
                updateRewardButtons();
                showToast(`You earned +${ppcRewardAmount} BDT from PPC #${index + 1}!`);
                btn.disabled = false;
                bonus = dailyClaimBonus + referralBonus;
                bonusEarnedEl.textContent = bonus.toFixed(2);
                updateTotalBalance();
              }, 3000);
            });
          } else {
            // Monetag SDK not available, proceed with reward
            btn.disabled = true;
            showToast(`Processing PPC claim #${index + 1}...`);
            setTimeout(() => {
              ppcRewards += ppcRewardAmount;
              localStorage.setItem(ppcClaimKey, Date.now().toString());
              saveUserData();
              updateRewardButtons();
              showToast(`You earned +${ppcRewardAmount} BDT from PPC #${index + 1}!`);
              btn.disabled = false;
              bonus = dailyClaimBonus + referralBonus;
              bonusEarnedEl.textContent = bonus.toFixed(2);
              updateTotalBalance();
            }, 3000);
          }
        }
      });
    });

    // Update cooldown timers for reward buttons
    function updateRewardButtons() {
      // Spin wheel timer
      if (canClaim('lastSpinClaim', rewardCooldown)) {
        spinTimer.textContent = 'Ready to spin!';
        spinButton.disabled = false;
        // Reset spins when cooldown expires
        if (spinsRemaining === 0) {
          spinsRemaining = 10;
          spinsRemainingEl.textContent = spinsRemaining;
          sessionRewards = 0;
          sessionRewardsEl.textContent = sessionRewards;
          spinResults.style.display = 'none';
        }
      } else {
        const timeLeft = timeToNextClaim('lastSpinClaim', rewardCooldown);
        spinTimer.textContent = 'Next spin session in: ' + formatTimeLeft(timeLeft);
        spinButton.disabled = spinsRemaining === 0;
      }
      
      // PPC rewards - handle all 5 buttons
      claimPpcRewardBtns.forEach((btn, index) => {
        const ppcClaimKey = `lastPpcClaim${index + 1}`;
        if (canClaim(ppcClaimKey, rewardCooldown)) {
          ppcRewardTimers[index].textContent = 'Ready to claim';
          btn.disabled = false;
        } else {
          const timeLeft = timeToNextClaim(ppcClaimKey, rewardCooldown);
          ppcRewardTimers[index].textContent = 'Next claim in: ' + formatTimeLeft(timeLeft);
          btn.disabled = true;
        }
      });
    }

    // Calculate total balance including all components
    function calculateTotalBalance() {
      return dailyClaimBonus + referralBonus + spinRewards + ppcRewards;
    }

    // Update total balance display
    function updateTotalBalance() {
      const totalBalance = calculateTotalBalance();
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';
    }

    // Daily bonus UI update
    function updateDailyBonusUI() {
      if (!user) {
        dailyBonusTimerEl.textContent = '';
        claimDailyBonusBtn.disabled = true;
        return;
      }
      if (canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
        dailyBonusTimerEl.textContent = 'Ready to claim your daily bonus!';
        claimDailyBonusBtn.disabled = false;
      } else {
        const timeLeft = timeToNextClaim('lastDailyBonusClaim', dailyBonusCooldown);
        dailyBonusTimerEl.textContent = 'Next daily bonus in: ' + formatTimeLeft(timeLeft);
        claimDailyBonusBtn.disabled = true;
      }
    }

    // Daily bonus claim handler
claimDailyBonusBtn.addEventListener('click', () => {
  if (!user) {
    showToast('Please login first');
    return;
  }
  if (!rewardsEnabled) {
    showToast('Rewards are currently disabled by admin.');
    return;
  }
  if (!canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
    showToast('Daily bonus already claimed. Please wait.');
    return;
  }
  // Show Monetag In-App Interstitial ad before granting daily bonus
  if (typeof show_9497269 === 'function') {
    show_9497269({
      type: 'inApp',
      inAppSettings: {
        frequency: 1,
        capping: 0,
        interval: 500,
        timeout: 0,
        everyPage: false
      }
    }).then(() => {
      // Ad watched or closed, proceed with daily bonus claim
      dailyClaimBonus += dailyBonusAmount;
      localStorage.setItem('lastDailyBonusClaim', Date.now().toString());
      saveUserData();
      updateDailyBonusUI();
      bonus = dailyClaimBonus + referralBonus;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`You claimed your daily bonus of +${dailyBonusAmount} BDT!`);
    }).catch(() => {
      // Ad failed or skipped, still proceed with daily bonus claim
      dailyClaimBonus += dailyBonusAmount;
      localStorage.setItem('lastDailyBonusClaim', Date.now().toString());
      saveUserData();
      updateDailyBonusUI();
      bonus = dailyClaimBonus + referralBonus;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`You claimed your daily bonus of +${dailyBonusAmount} BDT!`);
    });
  } else {
    // Monetag SDK not available, proceed with daily bonus claim
    dailyClaimBonus += dailyBonusAmount;
    localStorage.setItem('lastDailyBonusClaim', Date.now().toString());
    saveUserData();
    updateDailyBonusUI();
    bonus = dailyClaimBonus + referralBonus;
    bonusEarnedEl.textContent = bonus.toFixed(2);
    updateTotalBalance();
    showToast(`You claimed your daily bonus of +${dailyBonusAmount} BDT!`);
  }
});

    // Update timers every second
    setInterval(() => {
      if (user) {
        updateRewardButtons();
        updateDailyBonusUI();
      }
    }, 1000);

    // Investment button
    investBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      const amount = parseFloat(investmentAmountSel.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Select a valid amount');
        return;
      }
      // Check against investmentAvailableBalance from localStorage
      let investmentAvailableBalance = parseFloat(localStorage.getItem('investmentAvailableBalance')) || 0;
      if (amount > investmentAvailableBalance) {
        showToast('Insufficient investment available balance for this investment.');
        return;
      }
      
      // Create investment record for admin tracking
      const investment = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        startDate: new Date(),
        profitPercent: 0.20, // 20% profit after one week
        status: 'active'
      };
      
      // Save investment to localStorage for admin panel
      const existingInvestments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      existingInvestments.push(investment);
      localStorage.setItem('userInvestments', JSON.stringify(existingInvestments));
      
      // Deduct invested amount from investment available balance
      investmentAvailableBalance -= amount;
      investmentAvailableBalanceEl.textContent = investmentAvailableBalance.toFixed(2);
      // Save updated investment available balance in localStorage
      localStorage.setItem('investmentAvailableBalance', investmentAvailableBalance.toFixed(2));
      
      saveUserData();
      updateTotalBalance();
      showToast(`Invested ${amount.toFixed(2)} BDT successfully! Profit after one week: ${(amount * investment.profitPercent).toFixed(2)} BDT`);
      
      // Render updated investment history
      renderInvestmentHistory();
    });

    // Function to render investment history table
    function renderInvestmentHistory() {
      if (!user) return;
      const investments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      const userInvestments = investments.filter(inv => inv.userId === user.id);
      const tbody = document.getElementById('investment-history-body');
      tbody.innerHTML = '';
      userInvestments.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
        userInvestments.forEach(inv => {
          const date = new Date(inv.startDate);
          const statusText = inv.status === 'active' ? 'Active' : 'Completed';
          const now = new Date();
          const investmentPeriodDays = 7; // 7 days
          const daysPassed = Math.floor((now - date) / (1000 * 60 * 60 * 24));
          const daysRemaining = Math.max(investmentPeriodDays - daysPassed, 0);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${date.toLocaleString()}</td>
            <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${inv.amount.toFixed(2)}</td>
            <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${daysRemaining} days</td>
            <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${statusText}</td>
          `;
          tbody.appendChild(tr);
        });
    }

    // Call renderInvestmentHistory on UI render
    const originalRenderUI = renderUI;
    renderUI = function() {
      originalRenderUI();
      renderInvestmentHistory();
      updateBalances();
    };

    // Variables for deposit balance and profit
    let depositBalance = 0;
    const depositBalanceEl = document.getElementById('deposit-balance');
    const investmentAvailableBalanceEl = document.getElementById('investment-available-balance');
    const investmentBalanceEl = document.getElementById('investment-balance');
    const profitBalanceEl = document.getElementById('profit-balance');
    const transferDepositBtn = document.getElementById('transfer-deposit-btn');
    const transferToInvestmentAmountInput = document.getElementById('transfer-to-investment-amount');
    const transferToInvestmentBtn = document.getElementById('transfer-to-investment-btn');

    // Function to calculate investment profit based on weeks passed
    function calculateInvestmentProfit() {
      const investments = JSON.parse(localStorage.getItem('userInvestments') || '[]');
      let totalInvestment = 0;
      let totalProfit = 0;
      let updatedDepositBalance = depositBalance;
      const now = new Date();

      investments.forEach(inv => {
        if (inv.status === 'active') {
          const startDate = new Date(inv.startDate);
          const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
          if (daysPassed >= 7) {
            // One week passed, calculate profit and mark completed
            const profit = inv.amount * (inv.profitPercent || 0);
            totalProfit += profit;
            inv.status = 'completed';

            // Add invested amount + profit to depositBalance
            updatedDepositBalance += inv.amount + profit;
          } else {
            // Investment still active, count amount and profit for display
            totalInvestment += inv.amount;
            totalProfit += inv.amount * 0.20; // 20% profit on active investment
          }
        }
      });

      // Save updated investments back to localStorage
      localStorage.setItem('userInvestments', JSON.stringify(investments));
      saveUserData();

      return { totalInvestment, totalProfit, updatedDepositBalance };
    }

    // Function to update balances and UI
    function updateBalances() {
      // Load deposit balance from localStorage or initialize
      depositBalance = parseFloat(localStorage.getItem('depositBalance')) || 0;

      // Calculate investment profit and balance
      const { totalInvestment, totalProfit, updatedDepositBalance } = calculateInvestmentProfit();

      // Update depositBalance with updated value
      depositBalance = updatedDepositBalance;

      // Update currentInvestment to totalInvestment
      currentInvestment = totalInvestment;

      // Load investment available balance from localStorage or initialize
      let investmentAvailableBalance = parseFloat(localStorage.getItem('investmentAvailableBalance')) || 0;

      // Update UI elements
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      investmentAvailableBalanceEl.textContent = investmentAvailableBalance.toFixed(2);
      investmentBalanceEl.textContent = totalInvestment.toFixed(2);
      profitBalanceEl.textContent = totalProfit.toFixed(2);

      // Save updated deposit balance
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
    }

    // Auto-refresh balances every 10 seconds
    setInterval(() => {
      if (user) {
        updateBalances();
        // Enable or disable transfer buttons based on deposit balance
        transferDepositBtn.disabled = depositBalance <= 0;
        transferToInvestmentBtn.disabled = depositBalance <= 0;
      }
    }, 10000);

    // Initial balance update on page load
    updateBalances();

    // Transfer deposit to main balance button click handler
    transferDepositBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (depositBalance <= 0) {
        showToast('No deposit balance to transfer.');
        return;
      }
      const transferAmountInput = document.getElementById('transfer-deposit-amount');
      const amount = parseFloat(transferAmountInput.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid amount to transfer.');
        return;
      }
      if (amount > depositBalance) {
        showToast('Insufficient deposit balance to transfer that amount.');
        return;
      }
      // Transfer specified amount from deposit balance to main balance (dailyClaimBonus)
      dailyClaimBonus += amount; // Add to dailyClaimBonus as main balance component
      depositBalance -= amount;
      // Save updated deposit balance
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
      // Save updated user data with new dailyClaimBonus
      const userDataStr = localStorage.getItem(userDataKey);
      if (userDataStr) {
        try {
          const userData = JSON.parse(userDataStr);
          userData.dailyClaimBonus = dailyClaimBonus;
          localStorage.setItem(userDataKey, JSON.stringify(userData));
        } catch (e) {
          console.error('Error saving dailyClaimBonus:', e);
        }
      }
      // Update bonus variable to include all components except depositBalance
      bonus = dailyClaimBonus + referralBonus + spinRewards + ppcRewards;
      saveUserData();
      // Update UI
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Successfully transferred ${amount.toFixed(2)} BDT from deposit to main balance.`);
      // Disable button if deposit balance is zero
      transferDepositBtn.disabled = depositBalance <= 0;
      // Clear input
      transferAmountInput.value = '';
    });
    
    // Transfer deposit to investment available balance button click handler
    transferToInvestmentBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (depositBalance <= 0) {
        showToast('No deposit balance to transfer.');
        return;
      }
      const amount = parseFloat(transferToInvestmentAmountInput.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid amount to transfer.');
        return;
      }
      if (amount > depositBalance) {
        showToast('Insufficient deposit balance to transfer that amount.');
        return;
      }
      // Transfer specified amount from deposit balance to investment available balance
      // This means reducing depositBalance and increasing investment available balance
      depositBalance -= amount;
      let investmentAvailableBalance = parseFloat(localStorage.getItem('investmentAvailableBalance')) || 0;
      investmentAvailableBalance += amount;
      // Save updated balances
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
      localStorage.setItem('investmentAvailableBalance', investmentAvailableBalance.toFixed(2));
      saveUserData();
      // Update UI
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      investmentAvailableBalanceEl.textContent = investmentAvailableBalance.toFixed(2);
      // Disable button if deposit balance is zero
      transferToInvestmentBtn.disabled = depositBalance <= 0;
      // Clear input
      transferToInvestmentAmountInput.value = '';
      showToast(`Successfully transferred ${amount.toFixed(2)} BDT from deposit to investment available balance.`);
    });

    // New transfer main balance to deposit balance button click handler
    const transferMainBtn = document.getElementById('transfer-main-btn');
    const transferMainAmountInput = document.getElementById('transfer-main-amount');

    transferMainBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      const amount = parseFloat(transferMainAmountInput.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Please enter a valid amount to transfer.');
        return;
      }
      // Calculate total main balance including all components
      const totalMainBalance = dailyClaimBonus + referralBonus + spinRewards + ppcRewards;
      if (amount > totalMainBalance) {
        showToast('Insufficient main balance to transfer that amount.');
        return;
      }
      // Deduct amount from main balance components in order
      let remainingAmount = amount;
      if (dailyClaimBonus >= remainingAmount) {
        dailyClaimBonus -= remainingAmount;
        remainingAmount = 0;
      } else {
        remainingAmount -= dailyClaimBonus;
        dailyClaimBonus = 0;
      }
      if (remainingAmount > 0) {
        if (referralBonus >= remainingAmount) {
          referralBonus -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= referralBonus;
          referralBonus = 0;
        }
      }
      if (remainingAmount > 0) {
        if (spinRewards >= remainingAmount) {
          spinRewards -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= spinRewards;
          spinRewards = 0;
        }
      }
      if (remainingAmount > 0) {
        if (ppcRewards >= remainingAmount) {
          ppcRewards -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= ppcRewards;
          ppcRewards = 0;
        }
      }
      // Add amount to deposit balance
      depositBalance += amount;
      // Save updated deposit balance
      localStorage.setItem('depositBalance', depositBalance.toFixed(2));
      // Update bonus variable using updateBonus function
      updateBonus();
      // Save updated user data with new bonus components
      const userDataStr = localStorage.getItem(userDataKey);
      if (userDataStr) {
        try {
          const userData = JSON.parse(userDataStr);
          userData.dailyClaimBonus = dailyClaimBonus;
          userData.referralBonus = referralBonus;
          userData.spinRewards = spinRewards;
          userData.ppcRewards = ppcRewards;
          localStorage.setItem(userDataKey, JSON.stringify(userData));
        } catch (e) {
          console.error('Error saving user bonus data:', e);
        }
      }
      saveUserData();
      // Update UI
      depositBalanceEl.textContent = depositBalance.toFixed(2);
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Successfully transferred ${amount.toFixed(2)} BDT from main balance to deposit balance.`);
      // Clear input
      transferMainAmountInput.value = '';
    });

    // Deposit form handling
    depositForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!depositEnabled) {
        showToast('Deposits are currently disabled.');
        return;
      }
      if (!user) {
        showToast('Please login first');
        return;
      }
      const method = depositMethodSelect.value;
      const amount = parseFloat(depositAmountInput.value);
      const reference = depositReferenceInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !reference) {
        showToast('Please fill all deposit fields correctly.');
        return;
      }
      
      // Save deposit request for admin panel
      const deposits = JSON.parse(localStorage.getItem('deposits') || '[]');
      const newDeposit = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        method: method,
        reference: reference,
        status: 'pending',
        timestamp: Date.now()
      };
      
      deposits.push(newDeposit);
      localStorage.setItem('deposits', JSON.stringify(deposits));
      
      showToast(`Deposit request sent (${method.toUpperCase()}, ${amount}). Admin will verify soon.`);
      depositForm.reset();
      renderDepositHistory(); // Update deposit history after new request
    });
    // Withdraw form handling
    withdrawForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!withdrawEnabled) {
        showToast('Withdrawals are currently disabled.');
        return;
      }
      if (!user) {
        showToast('Please login first');
        return;
      }
      const method = withdrawMethodSelect.value;
      const amount = parseFloat(withdrawAmountInput.value);
      const address = withdrawAddressInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !address) {
        showToast('Please fill all withdraw fields correctly.');
        return;
      }
      // Enforce minimum withdraw amount of 20 BDT
      if (amount < 20) {
        showToast('Minimum withdraw amount is 20 BDT.');
        return;
      }
    // Calculate total balance and withdrawable balance
    updateBonus();
    const totalBalance = bonus + spinRewards + ppcRewards + currentInvestment;
    const withdrawableBalance = totalBalance; // user wants total balance as withdrawable balance
    if (amount > withdrawableBalance) {
      showToast('Insufficient balance to withdraw that amount.');
      return;
    }

      // Save withdrawal request for admin panel
      const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
      const newWithdrawal = {
        id: Date.now(),
        userId: user.id,
        userName: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
        amount: amount,
        method: method,
        address: address,
        status: 'pending',
        timestamp: Date.now()
      };
      
      withdrawals.push(newWithdrawal);
      localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
      
      // Deduct amount from dailyClaimBonus first, then referralBonus, then spinRewards, then ppcRewards if needed
      let remainingAmount = amount;
      if (dailyClaimBonus >= remainingAmount) {
        dailyClaimBonus -= remainingAmount;
        remainingAmount = 0;
      } else {
        remainingAmount -= dailyClaimBonus;
        dailyClaimBonus = 0;
      }
      if (remainingAmount > 0) {
        if (referralBonus >= remainingAmount) {
          referralBonus -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= referralBonus;
          referralBonus = 0;
        }
      }
      if (remainingAmount > 0) {
        if (spinRewards >= remainingAmount) {
          spinRewards -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= spinRewards;
          spinRewards = 0;
        }
      }
      if (remainingAmount > 0) {
        if (ppcRewards >= remainingAmount) {
          ppcRewards -= remainingAmount;
          remainingAmount = 0;
        } else {
          remainingAmount -= ppcRewards;
          ppcRewards = 0;
        }
      }

      saveUserData();
      updateBonus();
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Withdraw request sent (${method.toUpperCase()}, ${amount}). Admin will process soon.`);
      withdrawForm.reset();
      renderWithdrawHistory(); // Update withdraw history after new request
    });

    // Admin section navigation
    navButtons.admin.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      // Redirect to admin panel if admin
      if (isAdmin()) {
        window.location.href = 'admin.html';
      } else {
        showToast('Access denied: Admin privileges required');
      }
    });

    // Load admin settings on initialization
    loadAdminSettings();

    // Initialization
    if (!loadUserData()) {
      console.log('No saved user data found.');
    }
    renderUI();

    // Render deposit history for current user
    function renderDepositHistory() {
      const deposits = JSON.parse(localStorage.getItem('deposits') || '[]');
      const userDeposits = deposits.filter(d => user && d.userId === user.id);
      const tbody = document.getElementById('deposit-history-body');
      tbody.innerHTML = '';
      userDeposits.sort((a, b) => b.timestamp - a.timestamp);
      userDeposits.forEach(d => {
        const tr = document.createElement('tr');
        const date = new Date(d.timestamp);
        tr.innerHTML = `
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${date.toLocaleString()}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${d.amount.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${d.method}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${d.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Render withdraw history for current user
    function renderWithdrawHistory() {
      const withdrawals = JSON.parse(localStorage.getItem('withdrawals') || '[]');
      const userWithdrawals = withdrawals.filter(w => user && w.userId === user.id);
      const tbody = document.getElementById('withdraw-history-body');
      tbody.innerHTML = '';
      userWithdrawals.sort((a, b) => b.timestamp - a.timestamp);
      userWithdrawals.forEach(w => {
        const tr = document.createElement('tr');
        const date = new Date(w.timestamp);
        tr.innerHTML = `
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${date.toLocaleString()}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${w.amount.toFixed(2)}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${w.method}</td>
          <td style="padding: 8px; border-bottom: 1px solid #ffeb3b; color: #333;">${w.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Call render history functions on UI render
    function renderUI() {
      if (!user) {
        loginSection.classList.remove('hidden');
        homeSection.classList.add('hidden');
        spinSection.classList.add('hidden');
        ppcSection.classList.add('hidden');
        investmentSection.classList.add('hidden');
        depositWithdrawSection.classList.add('hidden');
        adminSection.classList.add('hidden');
        navButtons.admin.classList.add('hidden');
        return;
      }
      loginSection.classList.add('hidden');
      // Show home section and other sections as per nav
      navButtons.admin.classList.toggle('hidden', !isAdmin());

      // Show the first active content (home)
      showSection('home');

      // Update user info display
      userPhotoEl.src = user.photo_url || 'https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png';
      userNameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      userIdEl.textContent = "User ID: " + user.id;

      referralLinkEl.textContent = referralBaseURL + user.id;
      referralCountEl.textContent = referrals.length;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);

      // Total Balance = bonus + currentInvestment for demonstration
      // Replace with unified total balance calculation
      const totalBalance = calculateTotalBalance();
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' BDT';

      // Set deposit/withdraw enable switches in admin panel
      toggleDepositEnabled.checked = depositEnabled;
      toggleWithdrawEnabled.checked = withdrawEnabled;

      // Enable or disable deposit/withdraw forms based on admin control
      depositMethodSelect.disabled = !depositEnabled;
      depositAmountInput.disabled = !depositEnabled;
      depositReferenceInput.disabled = !depositEnabled;
      depositForm.querySelector('button[type="submit"]').disabled = !depositEnabled;

      withdrawMethodSelect.disabled = !withdrawEnabled;
      withdrawAmountInput.disabled = !withdrawEnabled;
      withdrawAddressInput.disabled = !withdrawEnabled;
      withdrawForm.querySelector('button[type="submit"]').disabled = !withdrawEnabled;

      // Update reward buttons cooldown timers
      updateRewardButtons();

      // Update daily bonus state UI
      updateDailyBonusUI();

      // Render deposit and withdraw history
      renderDepositHistory();
      renderWithdrawHistory();
    }

  })();



// Show Monetag In-App Interstitial ad 5 minutes after page load
setTimeout(() => {
  if (typeof show_9497269 === 'function') {
    show_9497269({
      type: 'inApp',
      inAppSettings: {
        frequency: 1,
        capping: 0,
        interval: 500,
        timeout: 0,
        everyPage: false
      }
    });
  }
}, 300000); // 300000 ms = 5 minutes

</script>
  <script>
    (() => {
      function loadNoticeText() {
        const noticeText = localStorage.getItem('noticeText') || '';
        const noticeTextEl = document.getElementById('notice-text');
        if (noticeTextEl) {
          if (noticeText.trim() === '') {
            noticeTextEl.textContent = 'No notices at the moment.';
          } else {
            noticeTextEl.textContent = noticeText;
          }
        }
      }
      // Load notice text on page load
      document.addEventListener('DOMContentLoaded', loadNoticeText);
    })();
  </script>
</body>
</html>

