<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Telegram Mini App - Rewards & Investment</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea,#764ba2);
    color: #f0f0f0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  #app {
    flex-grow:1;
    display: flex;
    flex-direction: column;
    max-width: 420px;
    margin: 0 auto;
    background: #1f1f3a;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
    overflow: hidden;
  }
  header {
    padding: 20px;
    background: #2c2c55;
    text-align: center;
    font-weight: 600;
    font-size: 1.5rem;
    letter-spacing: 1.2px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.8);
  }
  main {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
  }
  footer {
    display: flex;
    background: #222242;
    box-shadow: 0 -6px 20px rgba(0,0,0,0.6);
  }
  footer button {
    flex-grow: 1;
    padding: 12px 0;
    background: none;
    border: none;
    color: #bbb;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.3s, color 0.3s;
    position: relative;
  }
  footer button:hover,
  footer button.active {
    color: #fff;
    background: #5e52f3;
  }
  footer button svg {
    width: 24px; height: 24px;
    margin-bottom: 4px;
    fill: currentColor;
  }
  .hidden {
    display: none !important;
  }
  button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.3rem;
    margin-bottom: 16px;
    border-bottom: 2px solid #5e52f3;
    padding-bottom: 6px;
  }
  .card {
    background: #2c2c55;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: inset 0 0 20px rgb(94,82,243, 0.6);
  }
  .referral-link {
    background: #3d3d7a;
    border-radius: 8px;
    padding: 10px;
    font-family: monospace;
    user-select: all;
  }
  .copy-button {
    margin-top: 8px;
    padding: 8px 14px;
    background: #5e52f3;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .copy-button:hover {
    background-color: #483acb;
  }
  input[type=number], input[type=text], select {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    margin-top: 8px;
    background: rgba(255 255 255 / 0.1);
    color: #eee;
    transition: background-color 0.3s;
  }
  input[type=number]:focus, input[type=text]:focus, select:focus {
    background: rgba(255 255 255 / 0.20);
  }
  label {
    margin-top: 12px;
    font-weight: 600;
  }
  .btn-primary {
    background: #8a64f5;
    color:#fff;
    border: none;
    border-radius: 10px;
    padding: 12px 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 16px;
    width: 100%;
    transition: background-color 0.3s;
  }
  .btn-primary:disabled {
    background: #54438e;
    cursor: not-allowed;
  }
  .btn-primary:hover:not(:disabled) {
    background: #6f45e7;
  }
  .video-wrapper {
    aspect-ratio: 16 / 9;
    margin-bottom: 16px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px rgb(94,82,243, 0.6);
  }
  .admin-section {
    background: #421f59;
    padding: 14px;
    border-radius: 12px;
  }
  .admin-controls label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
  }
  .admin-controls input[type=checkbox] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
  .toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: #4444cc;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    box-shadow: 0 4px 20px rgb(100 80 255 / 0.9);
    font-weight: 600;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  .user-info {
    text-align: center;
    margin-bottom: 20px;
  }
  .user-info img {
    border-radius: 50%;
    width: 88px;
    height: 88px;
    border: 3px solid #5e52f3;
    margin-bottom: 12px;
  }
  .user-info .username {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 4px;
  }
  /* Total balance frame style */
  .total-balance-card {
    background: linear-gradient(135deg, #7b53ff, #5e52f3);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 18px;
    box-shadow: 0 0 20px #957fff77;
    text-align: center;
  }
  .total-balance-card .balance-label {
    font-size: 1rem;
    font-weight: 600;
    opacity: 0.85;
    margin-bottom: 6px;
  }
  .total-balance-card .balance-amount {
    font-size: 2.2rem;
    font-weight: 800;
  }
  /* Daily bonus UI */
  .daily-bonus {
    background: #3a2a6a;
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 24px;
    text-align: center;
    box-shadow: 0 0 12px #6b52e6aa;
  }
  .daily-bonus .bonus-amount {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: #b8a1ff;
  }
  .daily-bonus .bonus-timer {
    font-size: 0.95rem;
    margin-bottom: 12px;
    opacity: 0.9;
  }
  /* Referral card UI */
  .referral-card {
    background: #3a3a7a;
    border-radius: 14px;
    padding: 16px;
    margin-top: 12px;
    box-shadow: 0 0 15px rgb(94,82,243,0.8);
  }
</style>
</head>
<body>
<div id="app">
<header>
  Telegram Mini App
</header>
<main>
  <div id="login-section" class="">
    <!-- Telegram Login Widget placeholder -->
    <div style="text-align:center; margin-top:50px;">
      <img src="https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png" alt="Telegram" width="80" />
      <h2>Login with Telegram</h2>
      <button id="btn-tl-login" class="btn-primary">Simulate Telegram Login</button>
      <p>Click the button to simulate Telegram login (since API integration requires backend).</p>
    </div>
  </div>
  <section id="home-section" class="hidden">
    <div class="user-info">
      <img id="user-photo" src="" alt="User Photo" />
      <div class="username" id="user-name"></div>
      <div class="user-id" id="user-id" style="opacity:0.7; font-size:0.8rem;"></div>
    </div>

    <!-- Total Balance Card -->
    <div class="total-balance-card">
      <div class="balance-label">Total Balance</div>
      <div class="balance-amount" id="total-balance">0.00 TGR</div>
    </div>

    <!-- Daily Bonus Section -->
    <div class="daily-bonus">
      <div class="bonus-amount">Daily Bonus: +5 TGR</div>
      <div class="bonus-timer" id="daily-bonus-timer">Loading...</div>
      <button id="claim-daily-bonus" class="btn-primary" disabled>Claim Daily Bonus</button>
    </div>

    <p>Welcome to the Telegram Mini App dashboard.</p>
    
    <!-- Referral Card UI -->
    <div class="referral-card">
      <h3 class="section-title">Referral & Bonus System</h3>
      <div>Your referral link:</div>
      <div class="referral-link" id="referral-link"></div>
      <button class="copy-button" id="copy-referral">Copy Referral Link</button>
      <div style="margin-top: 12px;">
        <strong>Referral Count:</strong> <span id="referral-count">0</span><br/>
        <strong>Bonus Earned:</strong> <span id="bonus-earned">0.00</span> TGR
      </div>
    </div>
  </section>
  <section id="video-ads-section" class="hidden">
    <h3 class="section-title">Video Ads Reward (Claim every hour)</h3>
    <div class="video-wrapper">
      <iframe
        id="video-iframe"
        src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&controls=1"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        title="Reward Video"
      ></iframe>
    </div>
    <button id="claim-video-reward" class="btn-primary">Claim Video Ad Reward</button>
    <div id="video-reward-timer" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
  </section>
  <section id="ppc-section" class="hidden">
    <h3 class="section-title">Pay Per Click Rewards (Claim every hour)</h3>
    <button id="claim-ppc-reward" class="btn-primary">Claim PPC Reward</button>
    <div id="ppc-reward-timer" style="margin-top: 8px; font-size: 0.85rem; opacity: 0.8;"></div>
  </section>
  <section id="investment-section" class="hidden">
    <h3 class="section-title">Weekly Investment System</h3>
    <div class="card">
      <label for="investment-amount">Select Investment Amount (TGR):</label>
      <select id="investment-amount">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="250">250</option>
      </select>
      <button id="invest-btn" class="btn-primary">Invest Now</button>
      <div style="margin-top: 12px;">
        <strong>Your Current Investment:</strong> <span id="current-investment">0</span> TGR
      </div>
    </div>
  </section>
  <section id="deposit-withdraw-section" class="hidden">
    <h3 class="section-title">Offline Deposit & Withdraw</h3>
    <div class="card">
      <h4>Deposit</h4>
      <form id="deposit-form">
        <label for="deposit-method">Deposit Method:</label>
        <select id="deposit-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="deposit-amount">Amount (USD/TGR):</label>
        <input type="number" id="deposit-amount" min="1" required />
        <label for="deposit-reference">Transaction Reference:</label>
        <input type="text" id="deposit-reference" placeholder="Transaction ID or Details" required />
        <button type="submit" class="btn-primary">Submit Deposit Request</button>
      </form>
    </div>
    <div class="card" style="margin-top:24px;">
      <h4>Withdraw</h4>
      <form id="withdraw-form">
        <label for="withdraw-method">Withdraw Method:</label>
        <select id="withdraw-method" required>
          <option value="">Select Method</option>
          <option value="paypal">PayPal</option>
          <option value="bkash">bKash</option>
        </select>
        <label for="withdraw-amount">Amount (TGR):</label>
        <input type="number" id="withdraw-amount" min="1" required />
        <label for="withdraw-address">Withdrawal Address / Info:</label>
        <input type="text" id="withdraw-address" placeholder="Your PayPal or bKash Info" required />
        <button type="submit" class="btn-primary">Submit Withdraw Request</button>
      </form>
    </div>
  </section>
  <section id="admin-section" class="hidden admin-section">
    <h3 class="section-title">Admin Panel</h3>
    <div class="admin-controls">
      <label>
        <input type="checkbox" id="toggle-deposit-enabled" /> Deposits Enabled
      </label>
      <label>
        <input type="checkbox" id="toggle-withdraw-enabled" /> Withdrawals Enabled
      </label>
    </div>
  </section>
</main>
<footer>
  <button id="nav-home" class="active" aria-label="Home" title="Home">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    Home
  </button>
  <button id="nav-video" aria-label="Video Ads" title="Video Ads">
    <svg viewBox="0 0 24 24"><path d="M10 16.5l6-4.5-6-4.5v9z"/></svg>
    Video Ads
  </button>
  <button id="nav-ppc" aria-label="PPC Rewards" title="PPC Rewards">
    <svg viewBox="0 0 24 24"><path d="M13 17h-2v-2h2v2zm0-6h-2v-2h2v2zm4 4h-2v-2h2v2zm-8 0H7v-2h2v2zm8-4h-2V9h2v2zm-4 8c3.31 0 6-2.69 6-6h-2a4 4 0 01-4 4v2zm-6-6a6 6 0 0111.9-1h-2A4 4 0 009 13v2H7v-2z"/></svg>
    PPC
  </button>
  <button id="nav-investment" aria-label="Investment" title="Investment">
    <!-- Investment icon: upward trend chart -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M4 17h16v2H4v-2zm2-5h3v5H6v-5zm5-4h3v9h-3V8zm5-3h3v12h-3V5z"/></svg>
    Invest
  </button>
  <button id="nav-deposit" aria-label="Wallet" title="Wallet">
    <!-- Wallet icon -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M21 7H3c-.55 0-1 .45-1 1v8a3 3 0 0 0 3 3h13c1.1 0 2-.9 2-2v-8c0-.55-.45-1-1-1zm-7 5a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/></svg>
    Wallet
  </button>
  <button id="nav-admin" aria-label="Admin Panel" title="Admin Panel" class="hidden">
    <svg viewBox="0 0 24 24"><path d="M12 2L2 7v6c0 5 4 9 10 9s10-4 10-9V7l-10-5zm0 4l6 3.5v5L12 17l-6-2.5v-5L12 6z"/></svg>
    Admin
  </button>
</footer>
</div>

<div id="toast" class="toast">Message</div>

<script>
  (() => {
    const userDataKey = 'telegramMiniAppUser';
    const referralBaseURL = 'https://t.me/your_bot?start=';
    const referralBonusPerReferral = 1.5; // TGR coins per referral
    const dailyBonusAmount = 5; // Daily bonus amount TGR
    const videoRewardAmount = 2.5; // TGR per video ad claim
    const ppcRewardAmount = 1.2; // TGR per PPC claim
    // Reward claim cooldowns in ms
    const rewardCooldown = 1000 * 60 * 60; // 1 hour cooldown
    const dailyBonusCooldown = 1000 * 60 * 60 * 24; // 24 hours for daily bonus

    // Admin login check (for demo purpose only)
    const adminUserId = 1234567890; // Example admin user id

    // State
    let user = null;
    let referrals = []; // Array of user ids who used referral link
    let bonus = 0;
    let currentInvestment = 0;
    let depositEnabled = true;
    let withdrawEnabled = true;

    // Elements
    const loginSection = document.getElementById('login-section');
    const homeSection = document.getElementById('home-section');
    const videoAdsSection = document.getElementById('video-ads-section');
    const ppcSection = document.getElementById('ppc-section');
    const investmentSection = document.getElementById('investment-section');
    const depositWithdrawSection = document.getElementById('deposit-withdraw-section');
    const adminSection = document.getElementById('admin-section');

    const navButtons = {
      home: document.getElementById('nav-home'),
      video: document.getElementById('nav-video'),
      ppc: document.getElementById('nav-ppc'),
      investment: document.getElementById('nav-investment'),
      deposit: document.getElementById('nav-deposit'),
      admin: document.getElementById('nav-admin')
    };

    const userPhotoEl = document.getElementById('user-photo');
    const userNameEl = document.getElementById('user-name');
    const userIdEl = document.getElementById('user-id');

    const referralLinkEl = document.getElementById('referral-link');
    const referralCountEl = document.getElementById('referral-count');
    const bonusEarnedEl = document.getElementById('bonus-earned');

    const copyReferralBtn = document.getElementById('copy-referral');

    const claimVideoRewardBtn = document.getElementById('claim-video-reward');
    const videoRewardTimer = document.getElementById('video-reward-timer');

    const claimPpcRewardBtn = document.getElementById('claim-ppc-reward');
    const ppcRewardTimer = document.getElementById('ppc-reward-timer');

    const investmentAmountSel = document.getElementById('investment-amount');
    const investBtn = document.getElementById('invest-btn');
    const currentInvestmentEl = document.getElementById('current-investment');

    const depositForm = document.getElementById('deposit-form');
    const withdrawForm = document.getElementById('withdraw-form');

    const depositMethodSelect = document.getElementById('deposit-method');
    const withdrawMethodSelect = document.getElementById('withdraw-method');

    const depositAmountInput = document.getElementById('deposit-amount');
    const depositReferenceInput = document.getElementById('deposit-reference');

    const withdrawAmountInput = document.getElementById('withdraw-amount');
    const withdrawAddressInput = document.getElementById('withdraw-address');

    const toggleDepositEnabled = document.getElementById('toggle-deposit-enabled');
    const toggleWithdrawEnabled = document.getElementById('toggle-withdraw-enabled');

    const toastEl = document.getElementById('toast');

    // New daily bonus elements
    const dailyBonusTimerEl = document.getElementById('daily-bonus-timer');
    const claimDailyBonusBtn = document.getElementById('claim-daily-bonus');
    const totalBalanceEl = document.getElementById('total-balance');

    // Utility for toast message
    function showToast(msg, duration=3000) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => {
        toastEl.classList.remove('show');
      }, duration);
    }

    // Save user data and state to localStorage
    function saveUserData() {
      localStorage.setItem(userDataKey, JSON.stringify({
        user,
        referrals,
        bonus,
        currentInvestment,
        lastVideoClaim: parseInt(localStorage.getItem('lastVideoClaim')) || 0,
        lastPpcClaim: parseInt(localStorage.getItem('lastPpcClaim')) || 0,
        depositEnabled,
        withdrawEnabled,
        lastDailyBonusClaim: parseInt(localStorage.getItem('lastDailyBonusClaim')) || 0
      }));
    }

    // Load user data from localStorage
    function loadUserData() {
      const saved = localStorage.getItem(userDataKey);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          user = data.user || null;
          referrals = data.referrals || [];
          bonus = data.bonus || 0;
          currentInvestment = data.currentInvestment || 0;
          depositEnabled = data.depositEnabled !== undefined ? data.depositEnabled : true;
          withdrawEnabled = data.withdrawEnabled !== undefined ? data.withdrawEnabled : true;
          return true;
        } catch {
          return false;
        }
      }
      return false;
    }

    // Format time left in h:mm:ss
    function formatTimeLeft(ms) {
      if (ms <= 0) return 'Ready to claim';
      const totalSeconds = Math.floor(ms / 1000);
      const h = Math.floor(totalSeconds / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      const s = totalSeconds % 60;
      return `${h ? h + 'h ' : ''}${m}m ${s}s`;
    }

    // Check if user is admin
    function isAdmin() {
      return user && (user.id === adminUserId);
    }

    // Render user info and UI parts according to user state
    function renderUI() {
      if (!user) {
        loginSection.classList.remove('hidden');
        homeSection.classList.add('hidden');
        videoAdsSection.classList.add('hidden');
        ppcSection.classList.add('hidden');
        investmentSection.classList.add('hidden');
        depositWithdrawSection.classList.add('hidden');
        adminSection.classList.add('hidden');
        navButtons.admin.classList.add('hidden');
        return;
      }
      loginSection.classList.add('hidden');
      // Show home section and other sections as per nav
      navButtons.admin.classList.toggle('hidden', !isAdmin());

      // Show the first active content (home)
      showSection('home');

      // Update user info display
      userPhotoEl.src = user.photo_url || 'https://cdn.iconscout.com/icon/free/png-256/telegram-17-458475.png';
      userNameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      userIdEl.textContent = "User ID: " + user.id;

      referralLinkEl.textContent = referralBaseURL + user.id;
      referralCountEl.textContent = referrals.length;
      bonusEarnedEl.textContent = bonus.toFixed(2);
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);

      // Total Balance = bonus + currentInvestment for demonstration
      const totalBalance = bonus + currentInvestment;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' TGR';

      // Set deposit/withdraw enable switches in admin panel
      toggleDepositEnabled.checked = depositEnabled;
      toggleWithdrawEnabled.checked = withdrawEnabled;

      // Enable or disable deposit/withdraw forms based on admin control
      depositMethodSelect.disabled = !depositEnabled;
      depositAmountInput.disabled = !depositEnabled;
      depositReferenceInput.disabled = !depositEnabled;
      depositForm.querySelector('button[type="submit"]').disabled = !depositEnabled;

      withdrawMethodSelect.disabled = !withdrawEnabled;
      withdrawAmountInput.disabled = !withdrawEnabled;
      withdrawAddressInput.disabled = !withdrawEnabled;
      withdrawForm.querySelector('button[type="submit"]').disabled = !withdrawEnabled;

      // Update reward buttons cooldown timers
      updateRewardButtons();

      // Update daily bonus state UI
      updateDailyBonusUI();
    }

    // Show only one main section at a time
    function showSection(sectionName) {
      const sections = {
        home: homeSection,
        video: videoAdsSection,
        ppc: ppcSection,
        investment: investmentSection,
        deposit: depositWithdrawSection,
        admin: adminSection
      };
      Object.entries(sections).forEach(([key, el]) => {
        el.classList.toggle('hidden', key !== sectionName);
      });
      // Set active nav button
      Object.entries(navButtons).forEach(([key, btn]) => {
        btn.classList.toggle('active', key === sectionName);
      });
    }

    // Navigation buttons listeners
    Object.entries(navButtons).forEach(([key, btn]) => {
      btn.addEventListener('click', () => {
        if (!user) {
          showToast('Please login first.');
          return;
        }
        showSection(key);
      });
    });

    // Copy referral link
    copyReferralBtn.addEventListener('click', () => {
      if (!navigator.clipboard) {
        showToast('Clipboard not supported');
        return;
      }
      navigator.clipboard.writeText(referralLinkEl.textContent)
        .then(() => showToast('Referral link copied!'))
        .catch(() => showToast('Failed to copy'));
    });

    // Handle Telegram login simulation
    document.getElementById('btn-tl-login').addEventListener('click', () => {
      // Simulate login and store user data
      // Normally you get this data from Telegram widget with backend token check
      const simulatedUser = {
        id: Math.floor(Math.random() * 1000000) + 10000,
        first_name: 'Demo',
        last_name: 'User',
        username: 'demouser',
        photo_url: 'https://randomuser.me/api/portraits/lego/5.jpg'
      };
      setUser(simulatedUser);
    });

    // Set user after login
    function setUser(newUser) {
      user = newUser;
      // Check if this user came from referral param in URL (simulate it)
      const urlParams = new URLSearchParams(window.location.search);
      const referralId = urlParams.get('start'); // Telegram passes referral as ?start=...
      if (referralId && referralId != user.id.toString()) {
        // Add referral if not already
        if (!referrals.includes(referralId)) {
          referrals.push(referralId);
          bonus += referralBonusPerReferral;
          showToast(`Referral bonus added: +${referralBonusPerReferral} TGR`);
        }
      }
      saveUserData();
      renderUI();
      showToast('Logged in as ' + user.first_name);
    }

    // Reward claim timers
    function canClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      return now - lastClaim >= cooldown;
    }
    function timeToNextClaim(lastClaimKey, cooldown) {
      const lastClaim = parseInt(localStorage.getItem(lastClaimKey)) || 0;
      let now = Date.now();
      const diff = cooldown - (now - lastClaim);
      return diff > 0 ? diff : 0;
    }

    // Claim video ad reward handler
    claimVideoRewardBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (!canClaim('lastVideoClaim', rewardCooldown)) {
        showToast('Video reward already claimed. Please wait.');
        return;
      }
      // Simulate watching ad completion
      claimVideoRewardBtn.disabled = true;
      showToast('Watching Video Ad...');
      setTimeout(() => {
        bonus += videoRewardAmount;
        localStorage.setItem('lastVideoClaim', Date.now().toString());
        saveUserData();
        updateRewardButtons();
        showToast(`You earned +${videoRewardAmount} TGR from video ad!`);
        claimVideoRewardBtn.disabled = false;
        bonusEarnedEl.textContent = bonus.toFixed(2);
        updateTotalBalance();
      }, 4000);
    });

    // Claim PPC reward handler
    claimPpcRewardBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (!canClaim('lastPpcClaim', rewardCooldown)) {
        showToast('PPC reward already claimed. Please wait.');
        return;
      }
      claimPpcRewardBtn.disabled = true;
      showToast('Processing PPC claim...');
      setTimeout(() => {
        bonus += ppcRewardAmount;
        localStorage.setItem('lastPpcClaim', Date.now().toString());
        saveUserData();
        updateRewardButtons();
        showToast(`You earned +${ppcRewardAmount} TGR from PPC!`);
        claimPpcRewardBtn.disabled = false;
        bonusEarnedEl.textContent = bonus.toFixed(2);
        updateTotalBalance();
      }, 3000);
    });

    // Update cooldown timers for reward buttons
    function updateRewardButtons() {
      // Video ad reward
      if (canClaim('lastVideoClaim', rewardCooldown)) {
        videoRewardTimer.textContent = 'Ready to claim';
        claimVideoRewardBtn.disabled = false;
      } else {
        const timeLeft = timeToNextClaim('lastVideoClaim', rewardCooldown);
        videoRewardTimer.textContent = 'Next claim in: ' + formatTimeLeft(timeLeft);
        claimVideoRewardBtn.disabled = true;
      }
      // PPC reward
      if (canClaim('lastPpcClaim', rewardCooldown)) {
        ppcRewardTimer.textContent = 'Ready to claim';
        claimPpcRewardBtn.disabled = false;
      } else {
        const timeLeft = timeToNextClaim('lastPpcClaim', rewardCooldown);
        ppcRewardTimer.textContent = 'Next claim in: ' + formatTimeLeft(timeLeft);
        claimPpcRewardBtn.disabled = true;
      }
    }

    // Update total balance display
    function updateTotalBalance() {
      const totalBalance = bonus + currentInvestment;
      totalBalanceEl.textContent = totalBalance.toFixed(2) + ' TGR';
    }

    // Daily bonus UI update
    function updateDailyBonusUI() {
      if (!user) {
        dailyBonusTimerEl.textContent = '';
        claimDailyBonusBtn.disabled = true;
        return;
      }
      if (canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
        dailyBonusTimerEl.textContent = 'Ready to claim your daily bonus!';
        claimDailyBonusBtn.disabled = false;
      } else {
        const timeLeft = timeToNextClaim('lastDailyBonusClaim', dailyBonusCooldown);
        dailyBonusTimerEl.textContent = 'Next daily bonus in: ' + formatTimeLeft(timeLeft);
        claimDailyBonusBtn.disabled = true;
      }
    }

    // Daily bonus claim handler
    claimDailyBonusBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      if (!canClaim('lastDailyBonusClaim', dailyBonusCooldown)) {
        showToast('Daily bonus already claimed. Please wait.');
        return;
      }
      bonus += dailyBonusAmount;
      localStorage.setItem('lastDailyBonusClaim', Date.now().toString());
      saveUserData();
      updateDailyBonusUI();
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`You claimed your daily bonus of +${dailyBonusAmount} TGR!`);
    });

    // Update timers every second
    setInterval(() => {
      if (user) {
        updateRewardButtons();
        updateDailyBonusUI();
      }
    }, 1000);

    // Investment button
    investBtn.addEventListener('click', () => {
      if (!user) {
        showToast('Please login first');
        return;
      }
      const amount = parseFloat(investmentAmountSel.value);
      if (isNaN(amount) || amount <= 0) {
        showToast('Select a valid amount');
        return;
      }
      currentInvestment += amount;
      saveUserData();
      currentInvestmentEl.textContent = currentInvestment.toFixed(2);
      updateTotalBalance();
      showToast(`Invested ${amount.toFixed(2)} TGR successfully!`);
    });

    // Deposit form handling
    depositForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!depositEnabled) {
        showToast('Deposits are currently disabled.');
        return;
      }
      const method = depositMethodSelect.value;
      const amount = parseFloat(depositAmountInput.value);
      const reference = depositReferenceInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !reference) {
        showToast('Please fill all deposit fields correctly.');
        return;
      }
      // Simulate deposit submission
      showToast(`Deposit request sent (${method.toUpperCase()}, ${amount}). Admin will verify soon.`);
      depositForm.reset();
    });
    // Withdraw form handling
    withdrawForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!withdrawEnabled) {
        showToast('Withdrawals are currently disabled.');
        return;
      }
      const method = withdrawMethodSelect.value;
      const amount = parseFloat(withdrawAmountInput.value);
      const address = withdrawAddressInput.value.trim();
      if (!method || isNaN(amount) || amount <= 0 || !address) {
        showToast('Please fill all withdraw fields correctly.');
        return;
      }
      // Check if user has enough bonus balance to withdraw
      if (amount > bonus) {
        showToast('Insufficient balance to withdraw that amount.');
        return;
      }
      bonus -= amount;
      saveUserData();
      bonusEarnedEl.textContent = bonus.toFixed(2);
      updateTotalBalance();
      showToast(`Withdraw request sent (${method.toUpperCase()}, ${amount}). Admin will process soon.`);
      withdrawForm.reset();
    });

    // Admin toggle controls
    toggleDepositEnabled.addEventListener('change', () => {
      depositEnabled = toggleDepositEnabled.checked;
      saveUserData();
      renderUI();
    });
    toggleWithdrawEnabled.addEventListener('change', () => {
      withdrawEnabled = toggleWithdrawEnabled.checked;
      saveUserData();
      renderUI();
    });

    // Initialization
    if (!loadUserData()) {
      console.log('No saved user data found.');
    }
    renderUI();

  })();
</script>
</body>
</html>

