<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Telegram Mini App</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
  
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #f0f0f0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .admin-container {
    background: #1f1f3a;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
    overflow: hidden;
    width: 100%;
    max-width: 1200px;
    min-height: 600px;
  }
  
  .admin-header {
    background: #2c2c55;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.8);
  }
  
  .admin-header h1 {
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: 1.2px;
  }
  
  .admin-content {
    padding: 30px;
  }
  
  .login-section {
    max-width: 400px;
    margin: 0 auto;
    text-align: center;
  }
  
  .login-form {
    background: #2c2c55;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(94,82,243,0.6);
  }
  
  .form-group {
    margin-bottom: 20px;
    text-align: left;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #e0e0e0;
  }
  
  .form-group input {
    width: 100%;
    padding: 12px 16px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.1);
    color: #eee;
    transition: background-color 0.3s;
  }
  
  .form-group input:focus {
    background: rgba(255,255,255,0.2);
  }
  
  .btn-login {
    width: 100%;
    padding: 14px;
    background: #8a64f5;
    color: #fff;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .btn-login:hover {
    background: #6f45e7;
  }
  
  .btn-login:disabled {
    background: #54438e;
    cursor: not-allowed;
  }
  
  .dashboard-section {
    display: none;
  }
  
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .dashboard-card {
    background: #2c2c55;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 15px rgba(94,82,243,0.6);
  }
  
  .dashboard-card h3 {
    margin: 0 0 15px 0;
    color: #b8a1ff;
    font-size: 1.2rem;
    border-bottom: 2px solid #5e52f3;
    padding-bottom: 8px;
  }
  
  .stat-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .stat-value {
    font-weight: 600;
    color: #8a64f5;
  }
  
  .user-list {
    max-height: 300px;
    overflow-y: auto;
  }
  
  .user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 8px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
  }
  
  .user-info {
    flex-grow: 1;
  }
  
  .user-name {
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .user-details {
    font-size: 0.85rem;
    opacity: 0.8;
  }
  
  .user-actions {
    display: flex;
    gap: 8px;
  }
  
  .btn-small {
    padding: 6px 12px;
    font-size: 0.8rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .btn-approve {
    background: #28a745;
    color: white;
  }
  
  .btn-reject {
    background: #dc3545;
    color: white;
  }
  
  .btn-view {
    background: #17a2b8;
    color: white;
  }
  
  .btn-small:hover {
    opacity: 0.8;
  }
  
  .controls-section {
    background: #421f59;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
  }
  
  .controls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }
  
  .control-item {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .control-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
  
  .control-item label {
    font-weight: 600;
    cursor: pointer;
  }
  
  .logout-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 8px 16px;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }
  
  .logout-btn:hover {
    background: #c82333;
  }
  
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4444cc;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(100,80,255,0.9);
    font-weight: 600;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  
  .back-to-app {
    display: inline-block;
    margin-top: 20px;
    padding: 10px 20px;
    background: #5e52f3;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: background-color 0.3s;
  }
  
  .back-to-app:hover {
    background: #483acb;
  }
</style>
</head>
<body>
<div class="admin-container">
  <div class="admin-header">
    <h1>Admin Panel</h1>
    <button id="logout-btn" class="logout-btn" style="display: none;">Logout</button>
  </div>
  
  <div class="admin-content">
    <!-- Login Section -->
    <div id="login-section" class="login-section">
      <div class="login-form">
        <h2>Admin Login</h2>
        <form id="admin-login-form">
          <div class="form-group">
            <label for="admin-username">Username:</label>
            <input type="text" id="admin-username" required>
          </div>
          <div class="form-group">
            <label for="admin-password">Password:</label>
            <input type="password" id="admin-password" required>
          </div>
          <button type="submit" class="btn-login">Login</button>
        </form>
        <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.8;">
          Demo credentials: admin / admin123
        </p>
        <a href="code.html" class="back-to-app">← Back to Main App</a>
      </div>
    </div>
    
    <!-- Dashboard Section -->
    <div id="dashboard-section" class="dashboard-section">
      <!-- System Controls -->
      <div class="controls-section">
        <h3>System Controls</h3>
        <div class="controls-grid">
          <div class="control-item">
            <input type="checkbox" id="toggle-deposits" checked>
            <label for="toggle-deposits">Enable Deposits</label>
          </div>
          <div class="control-item">
            <input type="checkbox" id="toggle-withdrawals" checked>
            <label for="toggle-withdrawals">Enable Withdrawals</label>
          </div>
          <div class="control-item">
            <input type="checkbox" id="toggle-registrations" checked>
            <label for="toggle-registrations">Enable New Registrations</label>
          </div>
          <div class="control-item">
            <input type="checkbox" id="toggle-rewards" checked>
            <label for="toggle-rewards">Enable Reward Claims</label>
          </div>
        </div>
      </div>
      
      <!-- Dashboard Cards -->
      <div class="dashboard-grid">
        <!-- Statistics Card -->
        <div class="dashboard-card">
          <h3>System Statistics</h3>
          <div class="stat-item">
            <span>Total Users:</span>
            <span class="stat-value" id="total-users">0</span>
          </div>
          <div class="stat-item">
            <span>Active Users (24h):</span>
            <span class="stat-value" id="active-users">0</span>
          </div>
          <div class="stat-item">
            <span>Total Deposits:</span>
            <span class="stat-value" id="total-deposits">0 BDT</span>
          </div>
          <div class="stat-item">
            <span>Total Withdrawals:</span>
            <span class="stat-value" id="total-withdrawals">0 BDT</span>
          </div>
          <div class="stat-item">
            <span>Pending Requests:</span>
            <span class="stat-value" id="pending-requests">0</span>
          </div>
        </div>
        
        <!-- Recent Users -->
        <div class="dashboard-card">
          <h3>Recent Users</h3>
          <div class="user-list" id="recent-users">
            <!-- Users will be populated here -->
          </div>
        </div>
        
        <!-- Pending Deposits -->
        <div class="dashboard-card">
          <h3>Pending Deposits</h3>
          <div class="user-list" id="pending-deposits">
            <!-- Pending deposits will be populated here -->
          </div>
        </div>
        
        <!-- Pending Withdrawals -->
        <div class="dashboard-card">
          <h3>Pending Withdrawals</h3>
          <div class="user-list" id="pending-withdrawals">
            <!-- Pending withdrawals will be populated here -->
          </div>
        </div>
      </div>
      
      <a href="code.html" class="back-to-app">← Back to Main App</a>
    </div>
  </div>
</div>

<div id="toast" class="toast">Message</div>

<script>
(() => {
  // Admin credentials (in production, this should be server-side)
  const ADMIN_CREDENTIALS = {
    username: 'admin',
    password: 'admin123'
  };
  
  // Storage keys
  const ADMIN_SESSION_KEY = 'adminSession';
  const USER_DATA_KEY = 'telegramMiniAppUser';
  const ADMIN_SETTINGS_KEY = 'adminSettings';
  
  // Elements
  const loginSection = document.getElementById('login-section');
  const dashboardSection = document.getElementById('dashboard-section');
  const loginForm = document.getElementById('admin-login-form');
  const logoutBtn = document.getElementById('logout-btn');
  const toastEl = document.getElementById('toast');
  
  // Control elements
  const toggleDeposits = document.getElementById('toggle-deposits');
  const toggleWithdrawals = document.getElementById('toggle-withdrawals');
  const toggleRegistrations = document.getElementById('toggle-registrations');
  const toggleRewards = document.getElementById('toggle-rewards');
  
  // Statistics elements
  const totalUsersEl = document.getElementById('total-users');
  const activeUsersEl = document.getElementById('active-users');
  const totalDepositsEl = document.getElementById('total-deposits');
  const totalWithdrawalsEl = document.getElementById('total-withdrawals');
  const pendingRequestsEl = document.getElementById('pending-requests');
  
  // List elements
  const recentUsersEl = document.getElementById('recent-users');
  const pendingDepositsEl = document.getElementById('pending-deposits');
  const pendingWithdrawalsEl = document.getElementById('pending-withdrawals');
  
  // Mock data for demonstration
  let mockUsers = [
    { id: 12345, name: 'John Doe', balance: 150.50, lastActive: new Date(), status: 'active' },
    { id: 67890, name: 'Jane Smith', balance: 89.25, lastActive: new Date(Date.now() - 3600000), status: 'active' },
    { id: 11111, name: 'Bob Johnson', balance: 200.00, lastActive: new Date(Date.now() - 7200000), status: 'inactive' }
  ];
  
  let mockDeposits = [
    { id: 1, userId: 12345, userName: 'John Doe', amount: 50, method: 'bKash', reference: 'TXN123456', status: 'pending' },
    { id: 2, userId: 67890, userName: 'Jane Smith', amount: 25, method: 'PayPal', reference: 'PP789012', status: 'pending' }
  ];
  
  let mockWithdrawals = [
    { id: 1, userId: 11111, userName: 'Bob Johnson', amount: 30, method: 'bKash', address: '+8801234567890', status: 'pending' }
  ];
  
  // Utility functions
  function showToast(message, duration = 3000) {
    toastEl.textContent = message;
    toastEl.classList.add('show');
    setTimeout(() => {
      toastEl.classList.remove('show');
    }, duration);
  }
  
  function isAdminLoggedIn() {
    const session = localStorage.getItem(ADMIN_SESSION_KEY);
    if (!session) return false;
    
    try {
      const sessionData = JSON.parse(session);
      // Check if session is still valid (24 hours)
      const now = Date.now();
      const sessionAge = now - sessionData.timestamp;
      const maxAge = 24 * 60 * 60 * 1000; // 24 hours
      
      return sessionAge < maxAge;
    } catch {
      return false;
    }
  }
  
  function setAdminSession() {
    const sessionData = {
      timestamp: Date.now(),
      username: ADMIN_CREDENTIALS.username
    };
    localStorage.setItem(ADMIN_SESSION_KEY, JSON.stringify(sessionData));
  }
  
  function clearAdminSession() {
    localStorage.removeItem(ADMIN_SESSION_KEY);
  }
  
  function loadAdminSettings() {
    const settings = localStorage.getItem(ADMIN_SETTINGS_KEY);
    if (settings) {
      try {
        return JSON.parse(settings);
      } catch {
        return getDefaultSettings();
      }
    }
    return getDefaultSettings();
  }
  
  function saveAdminSettings(settings) {
    localStorage.setItem(ADMIN_SETTINGS_KEY, JSON.stringify(settings));
    // Also update the main app's settings
    const userData = localStorage.getItem(USER_DATA_KEY);
    if (userData) {
      try {
        const data = JSON.parse(userData);
        data.depositEnabled = settings.depositsEnabled;
        data.withdrawEnabled = settings.withdrawalsEnabled;
        localStorage.setItem(USER_DATA_KEY, JSON.stringify(data));
      } catch (e) {
        console.error('Error updating main app settings:', e);
      }
    }
  }
  
  function getDefaultSettings() {
    return {
      depositsEnabled: true,
      withdrawalsEnabled: true,
      registrationsEnabled: true,
      rewardsEnabled: true
    };
  }
  
  function formatDate(date) {
    return new Intl.DateTimeFormat('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }).format(date);
  }
  
  function renderDashboard() {
    // Update statistics
    totalUsersEl.textContent = mockUsers.length;
    activeUsersEl.textContent = mockUsers.filter(u => u.status === 'active').length;
    totalDepositsEl.textContent = mockDeposits.reduce((sum, d) => sum + d.amount, 0).toFixed(2) + ' BDT';
    totalWithdrawalsEl.textContent = mockWithdrawals.reduce((sum, w) => sum + w.amount, 0).toFixed(2) + ' BDT';
    pendingRequestsEl.textContent = mockDeposits.length + mockWithdrawals.length;
    
    // Render recent users
    recentUsersEl.innerHTML = mockUsers.map(user => `
      <div class="user-item">
        <div class="user-info">
          <div class="user-name">${user.name}</div>
          <div class="user-details">ID: ${user.id} | Balance: ${user.balance.toFixed(2)} BDT</div>
          <div class="user-details">Last Active: ${formatDate(user.lastActive)}</div>
        </div>
        <div class="user-actions">
          <button class="btn-small btn-view" onclick="viewUser(${user.id})">View</button>
        </div>
      </div>
    `).join('');
    
    // Render pending deposits
    pendingDepositsEl.innerHTML = mockDeposits.map(deposit => `
      <div class="user-item">
        <div class="user-info">
          <div class="user-name">${deposit.userName}</div>
          <div class="user-details">${deposit.amount} BDT via ${deposit.method}</div>
          <div class="user-details">Ref: ${deposit.reference}</div>
        </div>
        <div class="user-actions">
          <button class="btn-small btn-approve" onclick="approveDeposit(${deposit.id})">Approve</button>
          <button class="btn-small btn-reject" onclick="rejectDeposit(${deposit.id})">Reject</button>
        </div>
      </div>
    `).join('');
    
    // Render pending withdrawals
    pendingWithdrawalsEl.innerHTML = mockWithdrawals.map(withdrawal => `
      <div class="user-item">
        <div class="user-info">
          <div class="user-name">${withdrawal.userName}</div>
          <div class="user-details">${withdrawal.amount} BDT via ${withdrawal.method}</div>
          <div class="user-details">To: ${withdrawal.address}</div>
        </div>
        <div class="user-actions">
          <button class="btn-small btn-approve" onclick="approveWithdrawal(${withdrawal.id})">Approve</button>
          <button class="btn-small btn-reject" onclick="rejectWithdrawal(${withdrawal.id})">Reject</button>
        </div>
      </div>
    `).join('');
  }
  
  function showDashboard() {
    loginSection.style.display = 'none';
    dashboardSection.style.display = 'block';
    logoutBtn.style.display = 'block';
    
    // Load and apply admin settings
    const settings = loadAdminSettings();
    toggleDeposits.checked = settings.depositsEnabled;
    toggleWithdrawals.checked = settings.withdrawalsEnabled;
    toggleRegistrations.checked = settings.registrationsEnabled;
    toggleRewards.checked = settings.rewardsEnabled;
    
    renderDashboard();
  }
  
  function showLogin() {
    loginSection.style.display = 'block';
    dashboardSection.style.display = 'none';
    logoutBtn.style.display = 'none';
  }
  
  // Global functions for button actions
  window.viewUser = function(userId) {
    const user = mockUsers.find(u => u.id === userId);
    if (user) {
      showToast(`Viewing user: ${user.name} (ID: ${user.id})`);
    }
  };
  
  window.approveDeposit = function(depositId) {
    const depositIndex = mockDeposits.findIndex(d => d.id === depositId);
    if (depositIndex !== -1) {
      const deposit = mockDeposits[depositIndex];
      mockDeposits.splice(depositIndex, 1);
      showToast(`Deposit approved: ${deposit.amount} BDT for ${deposit.userName}`);
      renderDashboard();
    }
  };
  
  window.rejectDeposit = function(depositId) {
    const depositIndex = mockDeposits.findIndex(d => d.id === depositId);
    if (depositIndex !== -1) {
      const deposit = mockDeposits[depositIndex];
      mockDeposits.splice(depositIndex, 1);
      showToast(`Deposit rejected: ${deposit.amount} BDT for ${deposit.userName}`);
      renderDashboard();
    }
  };
  
  window.approveWithdrawal = function(withdrawalId) {
    const withdrawalIndex = mockWithdrawals.findIndex(w => w.id === withdrawalId);
    if (withdrawalIndex !== -1) {
      const withdrawal = mockWithdrawals[withdrawalIndex];
      mockWithdrawals.splice(withdrawalIndex, 1);
      showToast(`Withdrawal approved: ${withdrawal.amount} BDT for ${withdrawal.userName}`);
      renderDashboard();
    }
  };
  
  window.rejectWithdrawal = function(withdrawalId) {
    const withdrawalIndex = mockWithdrawals.findIndex(w => w.id === withdrawalId);
    if (withdrawalIndex !== -1) {
      const withdrawal = mockWithdrawals[withdrawalIndex];
      mockWithdrawals.splice(withdrawalIndex, 1);
      showToast(`Withdrawal rejected: ${withdrawal.amount} BDT for ${withdrawal.userName}`);
      renderDashboard();
    }
  };
  
  // Event listeners
  loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const username = document.getElementById('admin-username').value;
    const password = document.getElementById('admin-password').value;
    
    if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
      setAdminSession();
      showToast('Login successful!');
      showDashboard();
    } else {
      showToast('Invalid credentials!');
    }
  });
  
  logoutBtn.addEventListener('click', () => {
    clearAdminSession();
    showToast('Logged out successfully!');
    showLogin();
    loginForm.reset();
  });
  
  // Settings change handlers
  [toggleDeposits, toggleWithdrawals, toggleRegistrations, toggleRewards].forEach(toggle => {
    toggle.addEventListener('change', () => {
      const settings = {
        depositsEnabled: toggleDeposits.checked,
        withdrawalsEnabled: toggleWithdrawals.checked,
        registrationsEnabled: toggleRegistrations.checked,
        rewardsEnabled: toggleRewards.checked
      };
      saveAdminSettings(settings);
      showToast('Settings updated successfully!');
    });
  });
  
  // Initialize
  if (isAdminLoggedIn()) {
    showDashboard();
  } else {
    showLogin();
  }
})();
</script>
</body>
</html>
